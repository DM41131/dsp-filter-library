!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).DSPFilterLibrary={})}(this,function(t){"use strict";class e{static of(t=0,e=0){return{re:t,im:e}}static add(t,e){return{re:t.re+e.re,im:t.im+e.im}}static sub(t,e){return{re:t.re-e.re,im:t.im-e.im}}static mul(t,e){return{re:t.re*e.re-t.im*e.im,im:t.re*e.im+t.im*e.re}}static scale(t,e){return{re:t.re*e,im:t.im*e}}static conj(t){return{re:t.re,im:-t.im}}static div(t,e){const r=e.re*e.re+e.im*e.im||1e-300;return{re:(t.re*e.re+t.im*e.im)/r,im:(t.im*e.re-t.re*e.im)/r}}static abs(t){return Math.hypot(t.re,t.im)}static arg(t){return Math.atan2(t.im,t.re)}static expj(t){return{re:Math.cos(t),im:Math.sin(t)}}}const r=e;class s{static nextPow2(t){if(!Number.isFinite(t)||t<=1)return 1;let e=1;for(;e<t;)e*=2;return e}static clamp(t,e,r){return Math.min(r,Math.max(e,t))}static linspace(t,e,r){if(r<=0)return[];if(1===r)return[t];const s=(e-t)/(r-1);return Array.from({length:r},(e,r)=>t+r*s)}static polyval(t,r){if("number"==typeof r){let e=0;for(let s=t.length-1;s>=0;s--)e=e*r+t[s];return e}{let s=e.of(0,0);for(let a=t.length-1;a>=0;a--)s=e.add(e.mul(s,r),e.of(t[a],0));return s}}static convolve(t,e){const r=new Array(t.length+e.length-1).fill(0);for(let s=0;s<t.length;s++){const a=t[s];for(let t=0;t<e.length;t++)r[s+t]+=a*e[t]}return r}static polymul(t,e){const r=t.length,s=e.length,a=new Array(r+s-1).fill(0);for(let n=0;n<r;n++)for(let r=0;r<s;r++)a[n+r]+=t[n]*e[r];return a}static polyfromroots(t,e=1e-12){const r=new Array(t.length).fill(!1);let a=[1];for(let n=0;n<t.length;n++){if(r[n])continue;const o=t[n];let i=-1;for(let s=n+1;s<t.length;s++){if(r[s])continue;const a=t[s];if(Math.abs(o.re-a.re)<e&&Math.abs(o.im+a.im)<e){i=s;break}}if(Math.abs(o.im)<1e-14)a=s.polymul(a,[1,-o.re]),r[n]=!0;else if(i>=0){const t=[1,-2*o.re,o.re*o.re+o.im*o.im];a=s.polymul(a,t),r[n]=r[i]=!0}else{const t=[1,-2*o.re,o.re*o.re+o.im*o.im];a=s.polymul(a,t),r[n]=!0}}return a}}class a{static fft(t){let r=t.length;if(r<=1)return t;if(r&r-1){const n=s.nextPow2(r);return a.fft(t.concat(Array.from({length:n-r},()=>e.of(0,0))))}let n=0;for(let e=1;e<r-1;e++){let s=r>>1;for(;n&s;s>>=1)n^=s;if(n^=s,e<n){const r=t[e];t[e]=t[n],t[n]=r}}for(let s=2;s<=r;s<<=1){const a=-2*Math.PI/s;for(let n=0;n<r;n+=s)for(let r=0;r<s/2;r++){const o=e.expj(a*r),i=t[n+r],l=e.mul(t[n+r+(s>>1)],o);t[n+r]=e.add(i,l),t[n+r+(s>>1)]=e.sub(i,l)}}return t}static ifft(t){const r=t.length;return a.fft(t.map(e.conj)).map(e.conj).map(t=>e.scale(t,1/r))}static rfft(t){const r=s.nextPow2(t.length),n=Array.from({length:r},(r,s)=>e.of(t[s]||0,0));return a.fft(n)}static powerSpectrum(t){return a.rfft(t).map(e.abs).map(t=>t*t)}}class n{static rect(t){return Array.from({length:t},()=>1)}static rectangle(t){return n.rect(t)}static hann(t){return Array.from({length:t},(e,r)=>.5-.5*Math.cos(2*Math.PI*r/(t-1)))}static hamming(t){return Array.from({length:t},(e,r)=>.54-.46*Math.cos(2*Math.PI*r/(t-1)))}static blackman(t){return Array.from({length:t},(e,r)=>.42-.5*Math.cos(2*Math.PI*r/(t-1))+.08*Math.cos(4*Math.PI*r/(t-1)))}static blackmanHarris(t){return Array.from({length:t},(e,r)=>.35875-.48829*Math.cos(2*Math.PI*r/(t-1))+.14128*Math.cos(4*Math.PI*r/(t-1))-.01168*Math.cos(6*Math.PI*r/(t-1)))}static blackmanNuttall(t){return Array.from({length:t},(e,r)=>.3635819-.4891775*Math.cos(2*Math.PI*r/(t-1))+.1365995*Math.cos(4*Math.PI*r/(t-1))-.0106411*Math.cos(6*Math.PI*r/(t-1)))}static kaiser(t,e=8.6){const r=o(e),s=t-1;return Array.from({length:t},(t,a)=>{const n=2*a/s-1;return o(e*Math.sqrt(1-n*n))/r})}static tukey(t,e=.5){const r=t-1;return Array.from({length:t},(t,s)=>{const a=s/r;return e<=0?1:e>=1?.5*(1-Math.cos(2*Math.PI*a)):a<e/2?.5*(1+Math.cos(Math.PI*(2*a/e-1))):a<=1-e/2?1:.5*(1+Math.cos(Math.PI*(2*a/e-2/e+1)))})}static gauss(t,e=.4){const r=(t-1)/2;return Array.from({length:t},(t,s)=>{const a=(s-r)/(e*r);return Math.exp(-.5*a*a)})}static bartlett(t){const e=t-1;return Array.from({length:t},(t,r)=>1-Math.abs((r-e/2)/(e/2)))}static bartlettHann(t){const e=t-1;return Array.from({length:t},(t,r)=>{const s=r/e;return.62-.48*Math.abs(s-.5)-.38*Math.cos(2*Math.PI*s)})}static cosine(t){const e=t-1;return Array.from({length:t},(t,r)=>Math.sin(Math.PI*r/e))}static lanczos(t){const e=(t-1)/2;return Array.from({length:t},(t,r)=>{return 0===(s=(r-e)/e)?1:Math.sin(Math.PI*s)/(Math.PI*s);var s})}static bohman(t){const e=(t-1)/2;return Array.from({length:t},(t,r)=>{const s=Math.abs(r-e)/e;return s<=1?(1-s)*Math.cos(Math.PI*s)+1/Math.PI*Math.sin(Math.PI*s):0})}static flatTop(t){const e=t-1;return Array.from({length:t},(t,r)=>1-1.93*Math.cos(2*Math.PI*r/e)+1.29*Math.cos(4*Math.PI*r/e)-.388*Math.cos(6*Math.PI*r/e)+.028*Math.cos(8*Math.PI*r/e))}static byName(t,e,r={}){const{beta:s=8.6,alpha:a=.5,sigma:o=.4}=r||{};switch(t){case"hann":return n.hann(e);case"hamming":return n.hamming(e);case"blackman":return n.blackman(e);case"blackmanHarris":return n.blackmanHarris(e);case"blackmanNuttall":return n.blackmanNuttall(e);case"rectangle":case"rect":default:return n.rect(e);case"bartlett":return n.bartlett(e);case"bartlettHann":return n.bartlettHann(e);case"cosine":return n.cosine(e);case"lanczos":return n.lanczos(e);case"bohman":return n.bohman(e);case"gauss":case"gaussian":return n.gauss(e,o);case"tukey":return n.tukey(e,a);case"kaiser":return n.kaiser(e,s);case"flatTop":case"flattop":return n.flatTop(e)}}}const o=t=>{const e=Math.abs(t);if(e<3.75){const e=t/3.75,r=e*e;return 1+r*(3.5156229+r*(3.0899424+r*(1.2067492+r*(.2659732+r*(.0360768+.0045813*r)))))}{const t=3.75/e;return Math.exp(e)/Math.sqrt(e)*(.39894228+t*(.01328592+t*(.00225319+t*(t*(.00916281+t*(t*(.02635537+t*(.00392377*t-.01647633))-.02057706))-.00157565))))}};class i{static sinc(t){return 0===t?1:Math.sin(Math.PI*t)/(Math.PI*t)}static idealLowpass(t,e,r){const s=r-1,a=t/e;return Array.from({length:r},(t,e)=>i.sinc(2*(e-s/2)*a))}}class l{static design(t,e,r,s,a="hann"){const o=s+1,c=n.byName(a,o),h=o-1,u=t=>t.map((t,e)=>t*c[e]);if("lowpass"===t){const t=e;let s=i.idealLowpass(t,r,o);const a=2*t/r;return s=s.map(t=>t*a),{b:u(s),a:[1]}}if("highpass"===t){const t=e;return{b:l.design("lowpass",t,r,s,a).b.map((t,e)=>e===h/2?1-t:-t),a:[1]}}if("bandpass"===t){const[t,n]=e,o=l.design("lowpass",n,r,s,a).b,i=l.design("lowpass",t,r,s,a).b;return{b:o.map((t,e)=>t-i[e]),a:[1]}}if("bandstop"===t){const[t,n]=e;return{b:l.design("bandpass",[t,n],r,s,a).b.map((t,e)=>e===h/2?1-t:-t),a:[1]}}throw new Error("Unsupported FIR type")}static apply(t,e){return s.convolve(e,t)}static overlapAdd(t,r,n){const o=n||1024,i=t.length,l=s.nextPow2(o+i-1),c=a.fft(Array.from({length:l},(r,s)=>e.of(t[s]||0,0))),h=new Array(r.length+i-1).fill(0);for(let t=0;t<r.length;t+=o){const s=Array.from({length:l},(s,a)=>e.of(r[t+a]||0,0)),n=a.fft(s).map((t,r)=>e.mul(t,c[r])),u=a.ifft(n);for(let e=0;e<o+i-1;e++)h[t+e]+=u[e].re}return h}}class c{static prewarp(t,e){return 2*e*Math.tan(Math.PI*t/e)}}class h{static butterworthPoles(t){const r=[];for(let s=0;s<t;s++){const a=Math.PI*(2*s+1+t)/(2*t),n=e.of(Math.cos(a),Math.sin(a));n.re<0&&r.push(n)}return r}static cheby1Poles(t,r=1){const s=Math.sqrt(Math.pow(10,r/10)-1),a=Math.asinh(1/s)/t,n=Math.sinh(a),o=Math.cosh(a),i=[];for(let r=0;r<t;r++){const s=Math.PI*(2*r+1)/(2*t),a=-n*Math.sin(s),l=o*Math.cos(s),c=e.of(a,l);c.re<0&&i.push(c)}return i}static cheby2PolesAndZeros(t,r){const s=Math.sqrt(Math.pow(10,r/10)-1),a=Math.asinh(s)/t,n=Math.sinh(a),o=Math.cosh(a),i=[];for(let r=1;r<=t;r++){const s=Math.PI*(2*r-1)/(2*t),a=-n*Math.sin(s),l=o*Math.cos(s);a<0&&i.push(e.of(a,l))}const l=[],c=Math.floor(t/2);for(let e=1;e<=c;e++){const r=Math.PI*(2*e-1)/(2*t);l.push(1/Math.cos(r))}return{poles:i,zerosW:l}}static pairConjugates(t){const e=new Array(t.length).fill(!1),r=[];for(let s=0;s<t.length;s++){if(e[s])continue;const a=t[s];let n=-1;for(let r=s+1;r<t.length;r++){if(e[r])continue;const s=t[r];if(Math.abs(a.re-s.re)<1e-12&&Math.abs(a.im+s.im)<1e-12){n=r;break}}n>=0?(r.push([a,t[n]]),e[s]=e[n]=!0):(r.push([a]),e[s]=!0)}return r}static bilinearMapBiquad(t,e,r,s,a,n,o){const i=2*o,l=s*i*i+a*i+n;return{b:[(t*i*i+e*i+r)/l,2*(r-t*i*i)/l,(t*i*i-e*i+r)/l],a:[1,2*(n-s*i*i)/l,(s*i*i-a*i+n)/l]}}static _evalHzAtZ(t,e,r){return t.reduce((t,e,s)=>t+e*Math.pow(r,-s),0)/e.reduce((t,e,s)=>t+e*Math.pow(r,-s),0)}static fromPrototype(t,e,r,a,n){const o=[],i=h.pairConjugates(r);for(const r of i){const[s,a]=2===r.length?r:[r[0],null];let i,l,c,u,f,m,p,b,g;if(a?(i=1,l=-2*s.re,c=s.re*s.re+s.im*s.im):(i=0,l=1,c=-s.re),"lowpass"===t)u=i,f=l*n,m=c*n*n,p=0,b=0,g=1;else{if("highpass"!==t)throw new Error("fromPrototype supports only lowpass/highpass");0!==i?(u=c,f=l*n,m=i*n*n,p=1,b=0,g=0):(u=0,f=c,m=l*n,p=0,b=1,g=0)}o.push(h.bilinearMapBiquad(p,b,g,u,f,m,e))}let l=[1],c=[1];for(const t of o)l=s.polymul(l,t.b),c=s.polymul(c,t.a);const u=1/h._evalHzAtZ(l,c,a);if(o.length>0){const t=o.length-1;o[t].b=o[t].b.map(t=>t*u)}l=[1],c=[1];for(const t of o)l=s.polymul(l,t.b),c=s.polymul(c,t.a);return{b:l,a:c,sections:o}}static butterworth(t,e,r,s){if(s<1)throw new Error("Order must be >= 1");if("lowpass"===t||"highpass"===t){const a=e,n=c.prewarp(a,r),o=h.butterworthPoles(s),i="lowpass"===t?1:-1,l=h.fromPrototype(t,r,o,i,n);return{b:l.b,a:l.a,sections:l.sections}}if("bandpass"===t||"bandstop"===t){const[a,n]=e;if(!(a>0&&n>a&&n<r/2))throw new Error("Invalid band edges");const o=Math.max(64,8*s),i=l.design(t,[a,n],r,o,"hamming");return{b:i.b,a:i.a,sections:[]}}throw new Error("Unsupported IIR kind")}static cheby1(t,e,r,s,a=1){if(s<1)throw new Error("Order must be >= 1");if("lowpass"===t||"highpass"===t){const n=e,o=c.prewarp(n,r),i=h.cheby1Poles(s,a),l="lowpass"===t?1:-1,u=h.fromPrototype(t,r,i,l,o);return{b:u.b,a:u.a,sections:u.sections}}if("bandpass"===t||"bandstop"===t){const[a,n]=e;if(!(a>0&&n>a&&n<r/2))throw new Error("Invalid band edges");const o=Math.max(64,8*s),i=l.design(t,[a,n],r,o,"hamming");return{b:i.b,a:i.a,sections:[]}}throw new Error("Unsupported IIR kind")}static cheby2(t,r,a,n,o=40){if(n<1)throw new Error("Order must be >= 1");if("lowpass"!==t){const e=Math.max(64,8*n),s=l.design(t,r,a,e,"hamming");return{b:s.b,a:s.a,sections:[]}}const i=r,u=c.prewarp(i,a),{poles:f,zerosW:m}=h.cheby2PolesAndZeros(n,o),p=f.map(t=>e.of(t.re*u,t.im*u)),b=m.map(t=>u*t),g=h.pairConjugates(p),M=[],y=[],w=[];let d=0;for(const t of g){const[e,r]=2===t.length?t:[t[0],null];if(r){const t=1,r=-2*e.re,s=e.re*e.re+e.im*e.im;let a,n,o;if(d<b.length){const t=b[d++];a=1,n=0,o=t*t}else a=0,n=0,o=1;M.push({b2:a,b1:n,b0:o,a2:t,a1:r,a0:s}),y.push(o),w.push(s)}else{const t=0,r=1,s=-e.re,a=0,n=0,o=1;M.push({b2:a,b1:n,b0:o,a2:t,a1:r,a0:s}),y.push(1),w.push(s)}}const I=t=>t.reduce((t,e)=>t*e,1),P=I(w)/I(y);if(M.length>0){const t=M.length-1;M[t].b2*=P,M[t].b1*=P,M[t].b0*=P}const A=M.map(t=>h.bilinearMapBiquad(t.b2,t.b1,t.b0,t.a2,t.a1,t.a0,a));let _=[1],x=[1];for(const t of A)_=s.polymul(_,t.b),x=s.polymul(x,t.a);const k=1/h._evalHzAtZ(_,x,1);if(A.length>0){const t=A.length-1;A[t].b=A[t].b.map(t=>t*k)}_=[1],x=[1];for(const t of A)_=s.polymul(_,t.b),x=s.polymul(x,t.a);return{b:_,a:x,sections:A}}static linkwitzRiley(t,e,r,a=4){if(a<2)throw new Error("Order must be >= 2");const n=(a%2==0?a:a+1)/2,o=h.butterworth(t,e,r,n),i=o.sections.concat(o.sections.map(t=>({b:t.b.slice(),a:t.a.slice()})));return{b:s.polymul(o.b,o.b),a:s.polymul(o.a,o.a),sections:i}}}class u{static evalHz(t,r,s){const a=e.div(e.of(1,0),s),n=t=>{let r=e.of(1,0);for(let s=0;s<t;s++)r=e.mul(r,a);return r};let o=e.of(0,0);for(let r=0;r<t.length;r++)o=e.add(o,e.scale(n(r),t[r]));let i=e.of(1,0);for(let t=1;t<r.length;t++)i=e.add(i,e.scale(n(t),r[t]));return e.div(o,i)}static freqz(t,r,a=512){const n=s.linspace(0,Math.PI,a),o=n.map(s=>u.evalHz(t,r,e.expj(s))),i=o.map(e.abs),l=o.map(e.arg);return{w:n,H:o,mag:i,phase:l}}static groupDelay(t,e,r=512){const{w:s,phase:a}=u.freqz(t,e,r),n=[...a];for(let t=1;t<n.length;t++){let e=n[t]-n[t-1];for(;e>Math.PI;)n[t]-=2*Math.PI,e-=2*Math.PI;for(;e<-Math.PI;)n[t]+=2*Math.PI,e+=2*Math.PI}const o=s[1]-s[0];return{w:s,gd:n.map((t,e)=>0===e||e===n.length-1?0:-(n[e+1]-n[e-1])/(2*o))}}static isStable(){return!0}}class f{constructor(t,e=[1],r=[]){if(Math.abs(e[0]-1)>1e-12&&(t=t.map(t=>t/e[0]),e=e.map(t=>t/e[0])),this.b=t.slice(),this.a=e.slice(),this.sections=(r||[]).map(t=>({b:t.b.slice(),a:[1,t.a[1],t.a[2]]})),this.sections.length>0)this._sosState=this.sections.map(()=>({w1:0,w2:0}));else if(1===this.a.length)this._firIdx=0,this._firBuf=new Array(this.b.length).fill(0);else{const t=Math.max(this.b.length,this.a.length)-1;this._iirW=new Array(t).fill(0)}}reset(){this._sosState&&this._sosState.forEach(t=>{t.w1=0,t.w2=0}),this._firBuf&&(this._firBuf.fill(0),this._firIdx=0),this._iirW&&this._iirW.fill(0)}processSample(t){if(this.sections.length>0){let e=t;for(let t=0;t<this.sections.length;t++){const{b:r,a:s}=this.sections[t],a=this._sosState[t],n=e-s[1]*a.w1-s[2]*a.w2,o=r[0]*n+r[1]*a.w1+r[2]*a.w2;a.w2=a.w1,a.w1=n,e=o}return e}if(1===this.a.length){this._firBuf[this._firIdx]=t;let e=0,r=this._firIdx;for(let t=0;t<this.b.length;t++)e+=this.b[t]*this._firBuf[r],r=(r-1+this._firBuf.length)%this._firBuf.length;return this._firIdx=(this._firIdx+1)%this._firBuf.length,e}let e=t;for(let t=1;t<this.a.length;t++)e-=this.a[t]*(this._iirW[t-1]||0);let r=this.b[0]*e;for(let t=1;t<this.b.length;t++)r+=(this._iirW[t-1]||0)*this.b[t];for(let t=this._iirW.length-1;t>0;t--)this._iirW[t]=this._iirW[t-1];return this._iirW[0]=e,r}applySignal(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=this.processSample(t[r]);return e}frequencyResponse(t,e=1024){const r=u.freqz(this.b,this.a,e);return{f:r.w.map(e=>e*t/(2*Math.PI)),mag:r.mag,phase:r.phase,H:r.H}}toJSON(){return{b:this.b.slice(),a:this.a.slice()}}static fromTF(t,e){return new f(t,e)}static designFIR(t,e,r,s,a="hann"){const n=l.design(t,e,r,s,a);return new f(n.b,n.a)}static designButter(t,e,r,s){const a=h.butterworth(t,e,r,s);return new f(a.b,a.a,a.sections)}static designCheby1(t,e,r,s,a=1){const n=h.cheby1(t,e,r,s,a);return new f(n.b,n.a,n.sections)}static designCheby2(t,e,r,s,a=40){const n=h.cheby2(t,e,r,s,a);return new f(n.b,n.a,n.sections)}static designLinkwitzRiley(t,e,r,s=4){const a=h.linkwitzRiley(t,e,r,s);return new f(a.b,a.a,a.sections)}}const m={design:(t,e,r,s,a="hann")=>l.design(t,e,r,s,a),apply:(t,e)=>l.apply(t,e),overlapAdd:(t,e,r)=>l.overlapAdd(t,e,r)},p={butterworth:(t,e,r,s)=>{const a=h.butterworth(t,e,r,s);return{b:a.b,a:a.a}},cheby1:(t,e,r,s,a=1)=>{const n=h.cheby1(t,e,r,s,a);return{b:n.b,a:n.a}},cheby2:(t,e,r,s,a=40)=>{const n=h.cheby2(t,e,r,s,a);return{b:n.b,a:n.a}},linkwitzRiley:(t,e,r,s=4)=>{const a=h.linkwitzRiley(t,e,r,s);return{b:a.b,a:a.a}},apply:(t,e,r)=>f.fromTF(t,e).applySignal(r)},b={evalHz:(t,e,r)=>u.evalHz(t,e,r),freqz:(t,e,r=512)=>u.freqz(t,e,r),groupDelay:(t,e,r=512)=>u.groupDelay(t,e,r),isStable:()=>u.isStable()};var g={ComplexNum:e,C:r,Util:s,FFT:a,Window:n,Kernels:i,FIRDesigner:l,IIRDesigner:h,Bilinear:c,ZDomain:u,Filter:f,FIR:m,IIR:p,Z:b};t.Bilinear=c,t.C=r,t.ComplexNum=e,t.FFT=a,t.FIR=m,t.FIRDesigner=l,t.Filter=f,t.IIR=p,t.IIRDesigner=h,t.Kernels=i,t.Util=s,t.Window=n,t.Z=b,t.ZDomain=u,t.default=g,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=dsp-filter-library.min.js.map
