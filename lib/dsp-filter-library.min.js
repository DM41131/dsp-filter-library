!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).DSPFilterLibrary={})}(this,function(t){"use strict";class e{static of(t=0,e=0){return{re:t,im:e}}static add(t,e){return{re:t.re+e.re,im:t.im+e.im}}static sub(t,e){return{re:t.re-e.re,im:t.im-e.im}}static mul(t,e){return{re:t.re*e.re-t.im*e.im,im:t.re*e.im+t.im*e.re}}static scale(t,e){return{re:t.re*e,im:t.im*e}}static conj(t){return{re:t.re,im:-t.im}}static div(t,e){const r=e.re*e.re+e.im*e.im||1e-300;return{re:(t.re*e.re+t.im*e.im)/r,im:(t.im*e.re-t.re*e.im)/r}}static abs(t){return Math.hypot(t.re,t.im)}static arg(t){return Math.atan2(t.im,t.re)}static expj(t){return{re:Math.cos(t),im:Math.sin(t)}}}const r=e;class a{static nextPow2(t){let e=1;for(;e<t;)e<<=1;return e}static clamp(t,e,r){return Math.min(r,Math.max(e,t))}static linspace(t,e,r){if(r<=1)return[t];const a=(e-t)/(r-1);return Array.from({length:r},(e,r)=>t+r*a)}static polyval(t,r){if("number"==typeof r){let e=0;for(let a=0;a<t.length;a++)e=e*r+t[a];return e}{let a=e.of(0,0);for(let s=0;s<t.length;s++)a=e.add(e.mul(a,r),e.of(t[s],0));return a}}static convolve(t,e){const r=new Array(t.length+e.length-1).fill(0);for(let a=0;a<t.length;a++){const s=t[a];for(let t=0;t<e.length;t++)r[a+t]+=s*e[t]}return r}static polymul(t,e){const r=t.length,a=e.length,s=new Array(r+a-1).fill(0);for(let n=0;n<r;n++)for(let r=0;r<a;r++)s[n+r]+=t[n]*e[r];return s}static polyfromroots(t){const e=new Array(t.length).fill(!1);let r=[1];for(let s=0;s<t.length;s++){if(e[s])continue;const n=t[s];let i=-1;for(let r=s+1;r<t.length;r++){if(e[r])continue;const a=t[r];if(Math.abs(n.re-a.re)<1e-12&&Math.abs(n.im+a.im)<1e-12){i=r;break}}if(Math.abs(n.im)<1e-14||i<0)r=a.polymul(r,[1,-n.re]),e[s]=!0;else{const t=[1,-2*n.re,n.re*n.re+n.im*n.im];r=a.polymul(r,t),e[s]=e[i]=!0}}return r}}class s{static fft(t){let r=t.length;if(r<=1)return t;if(r&r-1){const n=a.nextPow2(r);return s.fft(t.concat(Array.from({length:n-r},()=>e.of(0,0))))}let n=0;for(let e=1;e<r-1;e++){let a=r>>1;for(;n&a;a>>=1)n^=a;if(n^=a,e<n){const r=t[e];t[e]=t[n],t[n]=r}}for(let a=2;a<=r;a<<=1){const s=-2*Math.PI/a;for(let n=0;n<r;n+=a)for(let r=0;r<a/2;r++){const i=e.expj(s*r),o=t[n+r],c=e.mul(t[n+r+(a>>1)],i);t[n+r]=e.add(o,c),t[n+r+(a>>1)]=e.sub(o,c)}}return t}static ifft(t){const r=t.length;return s.fft(t.map(e.conj)).map(e.conj).map(t=>e.scale(t,1/r))}static rfft(t){const r=a.nextPow2(t.length),n=Array.from({length:r},(r,a)=>e.of(t[a]||0,0));return s.fft(n)}static powerSpectrum(t){return s.rfft(t).map(e.abs).map(t=>t*t)}}class n{static rect(t){return Array.from({length:t},()=>1)}static rectangle(t){return n.rect(t)}static hann(t){return Array.from({length:t},(e,r)=>.5-.5*Math.cos(2*Math.PI*r/(t-1)))}static hamming(t){return Array.from({length:t},(e,r)=>.54-.46*Math.cos(2*Math.PI*r/(t-1)))}static blackman(t){return Array.from({length:t},(e,r)=>.42-.5*Math.cos(2*Math.PI*r/(t-1))+.08*Math.cos(4*Math.PI*r/(t-1)))}static blackmanHarris(t){return Array.from({length:t},(e,r)=>.35875-.48829*Math.cos(2*Math.PI*r/(t-1))+.14128*Math.cos(4*Math.PI*r/(t-1))-.01168*Math.cos(6*Math.PI*r/(t-1)))}static blackmanNuttall(t){return Array.from({length:t},(e,r)=>.3635819-.4891775*Math.cos(2*Math.PI*r/(t-1))+.1365995*Math.cos(4*Math.PI*r/(t-1))-.0106411*Math.cos(6*Math.PI*r/(t-1)))}static kaiser(t,e=8.6){const r=i(e),a=t-1;return Array.from({length:t},(t,s)=>{const n=2*s/a-1;return i(e*Math.sqrt(1-n*n))/r})}static tukey(t,e=.5){const r=t-1;return Array.from({length:t},(t,a)=>{const s=a/r;return e<=0?1:e>=1?.5*(1-Math.cos(2*Math.PI*s)):s<e/2?.5*(1+Math.cos(Math.PI*(2*s/e-1))):s<=1-e/2?1:.5*(1+Math.cos(Math.PI*(2*s/e-2/e+1)))})}static gauss(t,e=.4){const r=(t-1)/2;return Array.from({length:t},(t,a)=>{const s=(a-r)/(e*r);return Math.exp(-.5*s*s)})}static bartlett(t){const e=t-1;return Array.from({length:t},(t,r)=>1-Math.abs((r-e/2)/(e/2)))}static bartlettHann(t){const e=t-1;return Array.from({length:t},(t,r)=>{const a=r/e;return.62-.48*Math.abs(a-.5)-.38*Math.cos(2*Math.PI*a)})}static cosine(t){const e=t-1;return Array.from({length:t},(t,r)=>Math.sin(Math.PI*r/e))}static lanczos(t){const e=(t-1)/2;return Array.from({length:t},(t,r)=>{return 0===(a=(r-e)/e)?1:Math.sin(Math.PI*a)/(Math.PI*a);var a})}static bohman(t){const e=(t-1)/2;return Array.from({length:t},(t,r)=>{const a=Math.abs(r-e)/e;return a<=1?(1-a)*Math.cos(Math.PI*a)+1/Math.PI*Math.sin(Math.PI*a):0})}static flatTop(t){const e=t-1;return Array.from({length:t},(t,r)=>1-1.93*Math.cos(2*Math.PI*r/e)+1.29*Math.cos(4*Math.PI*r/e)-.388*Math.cos(6*Math.PI*r/e)+.028*Math.cos(8*Math.PI*r/e))}static byName(t,e,r={}){const{beta:a=8.6,alpha:s=.5,sigma:i=.4}=r||{};switch(t){case"hann":return n.hann(e);case"hamming":return n.hamming(e);case"blackman":return n.blackman(e);case"blackmanHarris":return n.blackmanHarris(e);case"blackmanNuttall":return n.blackmanNuttall(e);case"rectangle":case"rect":default:return n.rect(e);case"bartlett":return n.bartlett(e);case"bartlettHann":return n.bartlettHann(e);case"cosine":return n.cosine(e);case"lanczos":return n.lanczos(e);case"bohman":return n.bohman(e);case"gauss":case"gaussian":return n.gauss(e,i);case"tukey":return n.tukey(e,s);case"kaiser":return n.kaiser(e,a);case"flatTop":case"flattop":return n.flatTop(e)}}}const i=t=>{const e=Math.abs(t);if(e<3.75){const e=t/3.75,r=e*e;return 1+r*(3.5156229+r*(3.0899424+r*(1.2067492+r*(.2659732+r*(.0360768+.0045813*r)))))}{const t=3.75/e;return Math.exp(e)/Math.sqrt(e)*(.39894228+t*(.01328592+t*(.00225319+t*(t*(.00916281+t*(t*(.02635537+t*(.00392377*t-.01647633))-.02057706))-.00157565))))}};class o{static sinc(t){return 0===t?1:Math.sin(Math.PI*t)/(Math.PI*t)}static idealLowpass(t,e,r){const a=r-1,s=t/e;return Array.from({length:r},(t,e)=>o.sinc(2*(e-a/2)*s))}}class c{static design(t,e,r,a,s="hann"){const i=a+1,l=n.byName(s,i),h=i-1,f=t=>t.map((t,e)=>t*l[e]);if("lowpass"===t){const t=e;let a=o.idealLowpass(t,r,i);const s=2*t/r;return a=a.map(t=>t*s),{b:f(a),a:[1]}}if("highpass"===t){const t=e;return{b:c.design("lowpass",t,r,a,s).b.map((t,e)=>e===h/2?1-t:-t),a:[1]}}if("bandpass"===t){const[t,n]=e,i=c.design("lowpass",n,r,a,s).b,o=c.design("lowpass",t,r,a,s).b;return{b:i.map((t,e)=>t-o[e]),a:[1]}}if("bandstop"===t){const[t,n]=e;return{b:c.design("bandpass",[t,n],r,a,s).b.map((t,e)=>e===h/2?1-t:-t),a:[1]}}throw new Error("Unsupported FIR type")}static apply(t,e){return a.convolve(e,t)}static overlapAdd(t,r,n){const i=n||1024,o=t.length,c=a.nextPow2(i+o-1),l=s.fft(Array.from({length:c},(r,a)=>e.of(t[a]||0,0))),h=new Array(r.length+o-1).fill(0);for(let t=0;t<r.length;t+=i){const a=Array.from({length:c},(a,s)=>e.of(r[t+s]||0,0)),n=s.fft(a).map((t,r)=>e.mul(t,l[r])),f=s.ifft(n);for(let e=0;e<i+o-1;e++)h[t+e]+=f[e].re}return h}}class l{static prewarp(t,e){return 2*e*Math.tan(Math.PI*t/e)}}class h{static butterworthPoles(t){const r=[];for(let a=0;a<t;a++){const s=Math.PI*(2*a+1+t)/(2*t),n=e.of(Math.cos(s),Math.sin(s));n.re<0&&r.push(n)}return r}static cheby1Poles(t,r=1){const a=Math.sqrt(Math.pow(10,r/10)-1),s=(n=1/a,Math.log(n+Math.sqrt(n*n+1))/t);var n;const i=Math.sinh(s),o=Math.cosh(s),c=[];for(let r=0;r<t;r++){const a=Math.PI*(2*r+1)/(2*t),s=-i*Math.sin(a),n=o*Math.cos(a),l=e.of(s,n);l.re<0&&c.push(l)}return c}static pairConjugates(t){const e=new Array(t.length).fill(!1),r=[];for(let a=0;a<t.length;a++){if(e[a])continue;const s=t[a];let n=-1;for(let r=a+1;r<t.length;r++){if(e[r])continue;const a=t[r];if(Math.abs(s.re-a.re)<1e-12&&Math.abs(s.im+a.im)<1e-12){n=r;break}}n>=0?(r.push([s,t[n]]),e[a]=e[n]=!0):(r.push([s]),e[a]=!0)}return r}static bilinearBiquad(t,e,r,a,s){const n=2/(1/s),i=t*n*n+e*n+r;let o;return o="lowpass"===a?[1,2,1]:"highpass"===a?[1,-2,1]:[1,0,-1],{b:o,a:[1,(-2*t*n*n+2*r)/i,(t*n*n-e*n+r)/i]}}static fromPrototype(t,e,r,s){const n=[],i=h.pairConjugates(r);for(const r of i){const[a,s]=2===r.length?r:[r[0],null];let i,o,c;if(s){i=1,o=-2*a.re,c=a.re*a.re+a.im*a.im}else i=0,o=1,c=-a.re;n.push(h.bilinearBiquad(i,o,c,t,e))}let o=[1],c=[1];for(const t of n)o=a.polymul(o,t.b),c=a.polymul(c,t.a);const l=1/((t,e,r)=>t.reduce((t,e,a)=>t+e*Math.pow(r,-a),0)/e.reduce((t,e,a)=>t+e*Math.pow(r,-a),0))(o,c,s);o=o.map(t=>t*l);for(const t of n)t.b=t.b.map(t=>t*l);const f=c[0];if(Math.abs(f-1)>1e-14){o=o.map(t=>t/f),c=c.map(t=>t/f);for(const t of n)t.b=t.b.map(t=>t/f),t.a=[1,t.a[1]/f,t.a[2]/f]}return{b:o,a:c,sections:n}}static butterworth(t,r,a,s){if(s<1)throw new Error("Order must be >= 1");if("lowpass"===t||"highpass"===t){const n=r,i=l.prewarp(n,a),o=h.butterworthPoles(s).map(t=>e.scale(t,i)),c="lowpass"===t?1:-1,f=h.fromPrototype(t,a,o,c);return{b:f.b,a:f.a,sections:f.sections}}if("bandpass"===t||"bandstop"===t){const[e,n]=r;if(!(e>0&&n>e&&n<a/2))throw new Error("Invalid band edges");const i=Math.max(64,8*s),o=c.design(t,[e,n],a,i,"hamming");return{b:o.b,a:o.a,sections:[]}}throw new Error("Unsupported IIR kind")}static cheby1(t,r,a,s,n=1){if(s<1)throw new Error("Order must be >= 1");if("lowpass"===t||"highpass"===t){const i=r,o=l.prewarp(i,a),c=h.cheby1Poles(s,n).map(t=>e.scale(t,o)),f="lowpass"===t?1:-1,u=h.fromPrototype(t,a,c,f);return{b:u.b,a:u.a,sections:u.sections}}if("bandpass"===t||"bandstop"===t){const[e,n]=r;if(!(e>0&&n>e&&n<a/2))throw new Error("Invalid band edges");const i=Math.max(64,8*s),o=c.design(t,[e,n],a,i,"hamming");return{b:o.b,a:o.a,sections:[]}}throw new Error("Unsupported IIR kind")}}class f{static evalHz(t,r,a){const s=e.div(e.of(1,0),a),n=t=>{let r=e.of(1,0);for(let a=0;a<t;a++)r=e.mul(r,s);return r};let i=e.of(0,0);for(let r=0;r<t.length;r++)i=e.add(i,e.scale(n(r),t[r]));let o=e.of(1,0);for(let t=1;t<r.length;t++)o=e.add(o,e.scale(n(t),r[t]));return e.div(i,o)}static freqz(t,r,s=512){const n=a.linspace(0,Math.PI,s),i=n.map(a=>f.evalHz(t,r,e.expj(a))),o=i.map(e.abs),c=i.map(e.arg);return{w:n,H:i,mag:o,phase:c}}static groupDelay(t,e,r=512){const{w:a,phase:s}=f.freqz(t,e,r),n=[...s];for(let t=1;t<n.length;t++){let e=n[t]-n[t-1];for(;e>Math.PI;)n[t]-=2*Math.PI,e-=2*Math.PI;for(;e<-Math.PI;)n[t]+=2*Math.PI,e+=2*Math.PI}const i=a[1]-a[0];return{w:a,gd:n.map((t,e)=>0===e||e===n.length-1?0:-(n[e+1]-n[e-1])/(2*i))}}static isStable(){return!0}}class u{constructor(t,e=[1],r=[]){if(Math.abs(e[0]-1)>1e-12&&(t=t.map(t=>t/e[0]),e=e.map(t=>t/e[0])),this.b=t.slice(),this.a=e.slice(),this.sections=(r||[]).map(t=>({b:t.b.slice(),a:[1,t.a[1],t.a[2]]})),this.sections.length>0)this._sosState=this.sections.map(()=>({w1:0,w2:0}));else if(1===this.a.length)this._firIdx=0,this._firBuf=new Array(this.b.length).fill(0);else{const t=Math.max(this.b.length,this.a.length)-1;this._iirW=new Array(t).fill(0)}}reset(){this._sosState&&this._sosState.forEach(t=>{t.w1=0,t.w2=0}),this._firBuf&&(this._firBuf.fill(0),this._firIdx=0),this._iirW&&this._iirW.fill(0)}processSample(t){if(this.sections.length>0){let e=t;for(let t=0;t<this.sections.length;t++){const{b:r,a:a}=this.sections[t],s=this._sosState[t],n=e-a[1]*s.w1-a[2]*s.w2,i=r[0]*n+r[1]*s.w1+r[2]*s.w2;s.w2=s.w1,s.w1=n,e=i}return e}if(1===this.a.length){this._firBuf[this._firIdx]=t;let e=0,r=this._firIdx;for(let t=0;t<this.b.length;t++)e+=this.b[t]*this._firBuf[r],r=(r-1+this._firBuf.length)%this._firBuf.length;return this._firIdx=(this._firIdx+1)%this._firBuf.length,e}let e=t;for(let t=1;t<this.a.length;t++)e-=this.a[t]*(this._iirW[t-1]||0);let r=this.b[0]*e;for(let t=1;t<this.b.length;t++)r+=(this._iirW[t-1]||0)*this.b[t];for(let t=this._iirW.length-1;t>0;t--)this._iirW[t]=this._iirW[t-1];return this._iirW[0]=e,r}applySignal(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=this.processSample(t[r]);return e}frequencyResponse(t,e=1024){const r=f.freqz(this.b,this.a,e);return{f:r.w.map(e=>e*t/(2*Math.PI)),mag:r.mag,phase:r.phase,H:r.H}}toJSON(){return{b:this.b.slice(),a:this.a.slice()}}static fromTF(t,e){return new u(t,e)}static designFIR(t,e,r,a,s="hann"){const n=c.design(t,e,r,a,s);return new u(n.b,n.a)}static designButter(t,e,r,a){const s=h.butterworth(t,e,r,a);return new u(s.b,s.a,s.sections)}static designCheby1(t,e,r,a,s=1){const n=h.cheby1(t,e,r,a,s);return new u(n.b,n.a,n.sections)}}const m={design:(t,e,r,a,s="hann")=>c.design(t,e,r,a,s),apply:(t,e)=>c.apply(t,e),overlapAdd:(t,e,r)=>c.overlapAdd(t,e,r)},p={butterworth:(t,e,r,a)=>{const s=h.butterworth(t,e,r,a);return{b:s.b,a:s.a}},cheby1:(t,e,r,a,s=1)=>{const n=h.cheby1(t,e,r,a,s);return{b:n.b,a:n.a}},apply:(t,e,r)=>u.fromTF(t,e).applySignal(r)},b={evalHz:(t,e,r)=>f.evalHz(t,e,r),freqz:(t,e,r=512)=>f.freqz(t,e,r),groupDelay:(t,e,r=512)=>f.groupDelay(t,e,r),isStable:()=>f.isStable()};var g={ComplexNum:e,C:r,Util:a,FFT:s,Window:n,Kernels:o,FIRDesigner:c,IIRDesigner:h,Bilinear:l,ZDomain:f,Filter:u,FIR:m,IIR:p,Z:b};t.Bilinear=l,t.C=r,t.ComplexNum=e,t.FFT=s,t.FIR=m,t.FIRDesigner=c,t.Filter=u,t.IIR=p,t.IIRDesigner=h,t.Kernels=o,t.Util=a,t.Window=n,t.Z=b,t.ZDomain=f,t.default=g,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=dsp-filter-library.min.js.map
