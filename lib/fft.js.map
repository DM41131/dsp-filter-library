{"version":3,"file":"fft.js","sources":["../src/fft.js"],"sourcesContent":["// fft.js â€” Fast Fourier Transform operations\r\n// License: MIT\r\n\r\nimport { ComplexNum as C } from './complex.js';\r\nimport { Util } from './utils.js';\r\n\r\n/**\r\n * Fast Fourier Transform operations for digital signal processing\r\n */\r\nexport class FFT {\r\n    /** @param {Complex[]} x */\r\n    static fft(x) {\r\n        let n = x.length;\r\n        if (n <= 1) return x;\r\n        if ((n & (n - 1)) !== 0) {\r\n            const m = Util.nextPow2(n);\r\n            return FFT.fft(x.concat(Array.from({ length: m - n }, () => C.of(0, 0))));\r\n        }\r\n        // bit-reverse\r\n        let j = 0;\r\n        for (let i = 1; i < n - 1; i++) {\r\n            let bit = n >> 1;\r\n            for (; j & bit; bit >>= 1) j ^= bit;\r\n            j ^= bit;\r\n            if (i < j) { const t = x[i]; x[i] = x[j]; x[j] = t; }\r\n        }\r\n        // stages\r\n        for (let len = 2; len <= n; len <<= 1) {\r\n            const ang = -2 * Math.PI / len;\r\n            for (let i = 0; i < n; i += len) {\r\n                for (let k = 0; k < len / 2; k++) {\r\n                    const w = C.expj(ang * k);\r\n                    const u = x[i + k];\r\n                    const v = C.mul(x[i + k + (len >> 1)], w);\r\n                    x[i + k] = C.add(u, v);\r\n                    x[i + k + (len >> 1)] = C.sub(u, v);\r\n                }\r\n            }\r\n        }\r\n        return x;\r\n    }\r\n    \r\n    /** @param {Complex[]} X */\r\n    static ifft(X) {\r\n        const n = X.length;\r\n        return FFT.fft(X.map(C.conj)).map(C.conj).map(v => C.scale(v, 1 / n));\r\n    }\r\n    \r\n    /** @param {number[]} x */\r\n    static rfft(x) {\r\n        const n = Util.nextPow2(x.length);\r\n        const a = Array.from({ length: n }, (_, i) => C.of(x[i] || 0, 0));\r\n        return FFT.fft(a);\r\n    }\r\n    \r\n    /** @param {number[]} x */\r\n    static powerSpectrum(x) {\r\n        return FFT.rfft(x).map(C.abs).map(v => v*v);\r\n    }\r\n}\r\n"],"names":["C"],"mappings":"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"}