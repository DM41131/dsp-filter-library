{"version":3,"file":"zdomain.js","sources":["../src/zdomain.js"],"sourcesContent":["// zdomain.js â€” Z-domain operations for DSP\r\n// Author: Davit Akobia <dav.akobia@gmail.com>\r\n// License: MIT\r\n\r\nimport { ComplexNum as C } from './complex.js';\r\nimport { Util } from './utils.js';\r\n\r\n/**\r\n * @typedef {{w:number[], H:Complex[], mag:number[], phase:number[]}} FreqResponse\r\n */\r\n\r\n/**\r\n * Z-domain operations for digital signal processing\r\n */\r\nexport class ZDomain {\r\n    /** @returns {Complex} */\r\n    static evalHz(b, a, z) {\r\n        const zinv = C.div(C.of(1,0), z);\r\n        const pow = (k) => {\r\n            let p = C.of(1,0);\r\n            for (let i = 0; i < k; i++) p = C.mul(p, zinv);\r\n            return p;\r\n        };\r\n        let num = C.of(0,0);\r\n        for (let k = 0; k < b.length; k++) num = C.add(num, C.scale(pow(k), b[k]));\r\n        let den = C.of(1,0);\r\n        for (let k = 1; k < a.length; k++) den = C.add(den, C.scale(pow(k), a[k]));\r\n        return C.div(num, den);\r\n    }\r\n    \r\n    /** @returns {FreqResponse} */\r\n    static freqz(b, a, N = 512) {\r\n        const w = Util.linspace(0, Math.PI, N);\r\n        const H = w.map(wi => ZDomain.evalHz(b, a, C.expj(wi)));\r\n        const mag = H.map(C.abs);\r\n        const phase = H.map(C.arg);\r\n        return { w, H, mag, phase };\r\n    }\r\n    \r\n    static groupDelay(b, a, N = 512) {\r\n        const { w, phase } = ZDomain.freqz(b, a, N);\r\n        const unwrapped = [...phase];\r\n        for (let i = 1; i < unwrapped.length; i++) {\r\n            let d = unwrapped[i] - unwrapped[i-1];\r\n            while (d > Math.PI) { unwrapped[i] -= 2*Math.PI; d -= 2*Math.PI; }\r\n            while (d < -Math.PI) { unwrapped[i] += 2*Math.PI; d += 2*Math.PI; }\r\n        }\r\n        const dw = w[1] - w[0];\r\n        const gd = unwrapped.map((_, i) => (i === 0 || i === unwrapped.length - 1) ? 0\r\n            : -(unwrapped[i+1] - unwrapped[i-1]) / (2*dw));\r\n        return { w, gd };\r\n    }\r\n    \r\n    static isStable(/* a */) { \r\n        return true; // placeholder\r\n    }\r\n}\r\n"],"names":["C"],"mappings":";;;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAM,OAAO,CAAC;AACrB;AACA,IAAI,OAAO,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;AAC3B,QAAQ,MAAM,IAAI,GAAGA,UAAC,CAAC,GAAG,CAACA,UAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AACzC,QAAQ,MAAM,GAAG,GAAG,CAAC,CAAC,KAAK;AAC3B,YAAY,IAAI,CAAC,GAAGA,UAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC9B,YAAY,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,GAAGA,UAAC,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;AAC3D,YAAY,OAAO,CAAC,CAAC;AACrB,QAAQ,CAAC,CAAC;AACV,QAAQ,IAAI,GAAG,GAAGA,UAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC5B,QAAQ,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,GAAG,GAAGA,UAAC,CAAC,GAAG,CAAC,GAAG,EAAEA,UAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACnF,QAAQ,IAAI,GAAG,GAAGA,UAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC5B,QAAQ,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,GAAG,GAAGA,UAAC,CAAC,GAAG,CAAC,GAAG,EAAEA,UAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACnF,QAAQ,OAAOA,UAAC,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AAC/B,IAAI,CAAC;AACL;AACA;AACA,IAAI,OAAO,KAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE;AAChC,QAAQ,MAAM,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;AAC/C,QAAQ,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,IAAI,OAAO,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAEA,UAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAChE,QAAQ,MAAM,GAAG,GAAG,CAAC,CAAC,GAAG,CAACA,UAAC,CAAC,GAAG,CAAC,CAAC;AACjC,QAAQ,MAAM,KAAK,GAAG,CAAC,CAAC,GAAG,CAACA,UAAC,CAAC,GAAG,CAAC,CAAC;AACnC,QAAQ,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,KAAK,EAAE,CAAC;AACpC,IAAI,CAAC;AACL;AACA,IAAI,OAAO,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE;AACrC,QAAQ,MAAM,EAAE,CAAC,EAAE,KAAK,EAAE,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;AACpD,QAAQ,MAAM,SAAS,GAAG,CAAC,GAAG,KAAK,CAAC,CAAC;AACrC,QAAQ,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACnD,YAAY,IAAI,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAClD,YAAY,OAAO,CAAC,GAAG,IAAI,CAAC,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;AAC9E,YAAY,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;AAC/E,QAAQ,CAAC;AACT,QAAQ,MAAM,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;AAC/B,QAAQ,MAAM,EAAE,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,SAAS,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC;AACtF,cAAc,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AAC3D,QAAQ,OAAO,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC;AACzB,IAAI,CAAC;AACL;AACA,IAAI,OAAO,QAAQ,UAAU;AAC7B,QAAQ,OAAO,IAAI,CAAC;AACpB,IAAI,CAAC;AACL;;;;"}