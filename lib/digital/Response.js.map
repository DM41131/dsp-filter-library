{"version":3,"file":"Response.js","sources":["../../src/digital/Response.js"],"sourcesContent":["// Digital filter response calculations\r\nimport { Cx } from \"../core/Complex.js\";\r\nimport { unwrapPhase } from \"../core/util.js\";\r\n\r\nexport class Response {\r\n  static H_w_IIR(sections,w){\r\n    const z1={re:Math.cos(w),im:-Math.sin(w)}, z2={re:Math.cos(2*w),im:-Math.sin(2*w)};\r\n    let acc={re:1,im:0};\r\n    for(const s of sections){\r\n      const [b0,b1,b2]=s.b, [,a1,a2]=s.a;\r\n      const num={re:b0+b1*z1.re+b2*z2.re, im:b1*z1.im+b2*z2.im};\r\n      const den={re:1+a1*z1.re+a2*z2.re, im:a1*z1.im+a2*z2.im};\r\n      const den2=den.re*den.re+den.im*den.im;\r\n      const h={re:(num.re*den.re+num.im*den.im)/den2, im:(num.im*den.re-num.re*den.im)/den2};\r\n      acc = Cx.mul(acc,h);\r\n    }\r\n    return acc;\r\n  }\r\n  static H_w_FIR(taps,w){\r\n    let re=0, im=0;\r\n    for(let n=0;n<taps.length;n++){ re += taps[n]*Math.cos(w*n); im -= taps[n]*Math.sin(w*n); }\r\n    return {re, im};\r\n  }\r\n  static magDbFromH(H){ return 20*Math.log10(Math.max(1e-16, Cx.abs(H))); }\r\n  static unwrapToDeg(phRad){ return unwrapPhase(phRad).map(v=>v*180/Math.PI); }\r\n  static groupDelay(phUnwrappedRad, w){\r\n    const N=w.length, gd=new Array(N).fill(0);\r\n    if(N>=3){\r\n      for(let i=1;i<N-1;i++){\r\n        const dphi=phUnwrappedRad[i+1]-phUnwrappedRad[i-1], dw=w[i+1]-w[i-1];\r\n        gd[i] = - dphi / (dw || 1e-12);\r\n      }\r\n      gd[0]=gd[1]; gd[N-1]=gd[N-2];\r\n    }\r\n    return gd;\r\n  }\r\n  static phaseDelay(phUnwrappedRad, w){\r\n    const pd=new Array(w.length).fill(0);\r\n    for(let i=0;i<w.length;i++) pd[i] = (w[i]===0 ? NaN : -phUnwrappedRad[i]/w[i]);\r\n    let firstFinite = pd.find(v=>Number.isFinite(v)); if(!Number.isFinite(firstFinite)) firstFinite=0;\r\n    for(let i=0;i<pd.length && !Number.isFinite(pd[i]); i++) pd[i]=firstFinite;\r\n    for(let i=1;i<pd.length;i++) if(!Number.isFinite(pd[i])) pd[i]=pd[i-1];\r\n    return pd;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;AAAA;AAGA;AACO,MAAM,QAAQ,CAAC;AACtB,EAAE,OAAO,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC;AAC5B,IAAI,MAAM,EAAE,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACvF,IAAI,IAAI,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACxB,IAAI,IAAI,MAAM,CAAC,IAAI,QAAQ,CAAC;AAC5B,MAAM,MAAM,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACzC,MAAM,MAAM,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;AAChE,MAAM,MAAM,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;AAC/D,MAAM,MAAM,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC;AAC7C,MAAM,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;AAC7F,MAAM,GAAG,GAAG,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AAC1B,IAAI,CAAC;AACL,IAAI,OAAO,GAAG,CAAC;AACf,EAAE,CAAC;AACH,EAAE,OAAO,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;AACxB,IAAI,IAAI,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;AACnB,IAAI,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC/F,IAAI,OAAO,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;AACpB,EAAE,CAAC;AACH,EAAE,OAAO,UAAU,CAAC,CAAC,CAAC,EAAE,OAAO,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC3E,EAAE,OAAO,WAAW,CAAC,KAAK,CAAC,EAAE,OAAO,WAAW,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAC/E,EAAE,OAAO,UAAU,CAAC,cAAc,EAAE,CAAC,CAAC;AACtC,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AAC9C,IAAI,GAAG,CAAC,EAAE,CAAC,CAAC;AACZ,MAAM,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;AAC5B,QAAQ,MAAM,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC7E,QAAQ,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,IAAI,IAAI,EAAE,IAAI,KAAK,CAAC,CAAC;AACvC,MAAM,CAAC;AACP,MAAM,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACnC,IAAI,CAAC;AACL,IAAI,OAAO,EAAE,CAAC;AACd,EAAE,CAAC;AACH,EAAE,OAAO,UAAU,CAAC,cAAc,EAAE,CAAC,CAAC;AACtC,IAAI,MAAM,EAAE,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AACzC,IAAI,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACnF,IAAI,IAAI,WAAW,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE,WAAW,CAAC,CAAC,CAAC;AACtG,IAAI,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC;AAC/E,IAAI,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC3E,IAAI,OAAO,EAAE,CAAC;AACd,EAAE,CAAC;AACH;;;;"}