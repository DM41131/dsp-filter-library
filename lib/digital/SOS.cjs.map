{"version":3,"file":"SOS.cjs","sources":["../../src/digital/SOS.js"],"sourcesContent":["// Second Order Sections\r\nimport { Cx } from \"../core/Complex.js\";\r\n\r\nfunction pairConjs(arr){\r\n  const used=new Array(arr.length).fill(false), pairs=[];\r\n  for(let i=0;i<arr.length;i++){\r\n    if(used[i]) continue; const a=arr[i]; let matched=false;\r\n    for(let j=i+1;j<arr.length;j++) if(!used[j]){\r\n      const b=arr[j];\r\n      if(Math.abs(a.re-b.re)<1e-10 && Math.abs(a.im+b.im)<1e-10){\r\n        pairs.push([a,b]); used[i]=used[j]=true; matched=true; break;\r\n      }\r\n    }\r\n    if(!matched){ pairs.push([a]); used[i]=true; }\r\n  }\r\n  return pairs;\r\n}\r\n\r\nexport class SOS {\r\n  static fromZPK(zZeros, zPoles, gain=1){\r\n    while(zZeros.length<zPoles.length) zZeros.push({re:-1,im:0});\r\n    const zp=pairConjs(zZeros), pp=pairConjs(zPoles);\r\n    const sections=[]; let zi=0, pi=0;\r\n    while(pi<pp.length){\r\n      const ppair=pp[pi++], zpair=(zi<zp.length)?zp[zi++]:[{re:-1,im:0},{re:-1,im:0}];\r\n      const p1=ppair[0], p2=ppair[1]||{re:0,im:0};\r\n      const z1=zpair[0], z2=zpair[1]||{re:-1,im:0};\r\n      const sumZ={re:z1.re+z2.re, im:z1.im+z2.im}, prodZ=Cx.mul(z1,z2);\r\n      const sumP={re:p1.re+p2.re, im:p1.im+p2.im}, prodP=Cx.mul(p1,p2);\r\n      const b=[1, -sumZ.re, prodZ.re];\r\n      const a=[1, -sumP.re, prodP.re];\r\n      sections.push({b,a});\r\n    }\r\n    if(sections.length) sections[0].b=[sections[0].b[0]*gain, sections[0].b[1]*gain, sections[0].b[2]*gain];\r\n    return sections;\r\n  }\r\n}\r\n"],"names":["Cx"],"mappings":"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"}