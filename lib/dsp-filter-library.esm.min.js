class t{static of(t=0,e=0){return{re:t,im:e}}static add(t,e){return{re:t.re+e.re,im:t.im+e.im}}static sub(t,e){return{re:t.re-e.re,im:t.im-e.im}}static mul(t,e){return{re:t.re*e.re-t.im*e.im,im:t.re*e.im+t.im*e.re}}static scale(t,e){return{re:t.re*e,im:t.im*e}}static conj(t){return{re:t.re,im:-t.im}}static div(t,e){const r=e.re*e.re+e.im*e.im||1e-300;return{re:(t.re*e.re+t.im*e.im)/r,im:(t.im*e.re-t.re*e.im)/r}}static abs(t){return Math.hypot(t.re,t.im)}static arg(t){return Math.atan2(t.im,t.re)}static expj(t){return{re:Math.cos(t),im:Math.sin(t)}}}const e=t;class r{static nextPow2(t){if(!Number.isFinite(t)||t<=1)return 1;let e=1;for(;e<t;)e*=2;return e}static clamp(t,e,r){return Math.min(r,Math.max(e,t))}static linspace(t,e,r){if(r<=0)return[];if(1===r)return[t];const s=(e-t)/(r-1);return Array.from({length:r},(e,r)=>t+r*s)}static polyval(e,r){if("number"==typeof r){let t=0;for(let s=e.length-1;s>=0;s--)t=t*r+e[s];return t}{let s=t.of(0,0);for(let a=e.length-1;a>=0;a--)s=t.add(t.mul(s,r),t.of(e[a],0));return s}}static convolve(t,e){const r=new Array(t.length+e.length-1).fill(0);for(let s=0;s<t.length;s++){const a=t[s];for(let t=0;t<e.length;t++)r[s+t]+=a*e[t]}return r}static polymul(t,e){const r=t.length,s=e.length,a=new Array(r+s-1).fill(0);for(let n=0;n<r;n++)for(let r=0;r<s;r++)a[n+r]+=t[n]*e[r];return a}static polyfromroots(t,e=1e-12){const s=new Array(t.length).fill(!1);let a=[1];for(let n=0;n<t.length;n++){if(s[n])continue;const o=t[n];let i=-1;for(let r=n+1;r<t.length;r++){if(s[r])continue;const a=t[r];if(Math.abs(o.re-a.re)<e&&Math.abs(o.im+a.im)<e){i=r;break}}if(Math.abs(o.im)<1e-14)a=r.polymul(a,[1,-o.re]),s[n]=!0;else if(i>=0){const t=[1,-2*o.re,o.re*o.re+o.im*o.im];a=r.polymul(a,t),s[n]=s[i]=!0}else{const t=[1,-2*o.re,o.re*o.re+o.im*o.im];a=r.polymul(a,t),s[n]=!0}}return a}}class s{static fft(e){let a=e.length;if(a<=1)return e;if(a&a-1){const n=r.nextPow2(a);return s.fft(e.concat(Array.from({length:n-a},()=>t.of(0,0))))}let n=0;for(let t=1;t<a-1;t++){let r=a>>1;for(;n&r;r>>=1)n^=r;if(n^=r,t<n){const r=e[t];e[t]=e[n],e[n]=r}}for(let r=2;r<=a;r<<=1){const s=-2*Math.PI/r;for(let n=0;n<a;n+=r)for(let a=0;a<r/2;a++){const o=t.expj(s*a),i=e[n+a],c=t.mul(e[n+a+(r>>1)],o);e[n+a]=t.add(i,c),e[n+a+(r>>1)]=t.sub(i,c)}}return e}static ifft(e){const r=e.length;return s.fft(e.map(t.conj)).map(t.conj).map(e=>t.scale(e,1/r))}static rfft(e){const a=r.nextPow2(e.length),n=Array.from({length:a},(r,s)=>t.of(e[s]||0,0));return s.fft(n)}static powerSpectrum(e){return s.rfft(e).map(t.abs).map(t=>t*t)}}class a{static rect(t){return Array.from({length:t},()=>1)}static rectangle(t){return a.rect(t)}static hann(t){return Array.from({length:t},(e,r)=>.5-.5*Math.cos(2*Math.PI*r/(t-1)))}static hamming(t){return Array.from({length:t},(e,r)=>.54-.46*Math.cos(2*Math.PI*r/(t-1)))}static blackman(t){return Array.from({length:t},(e,r)=>.42-.5*Math.cos(2*Math.PI*r/(t-1))+.08*Math.cos(4*Math.PI*r/(t-1)))}static blackmanHarris(t){return Array.from({length:t},(e,r)=>.35875-.48829*Math.cos(2*Math.PI*r/(t-1))+.14128*Math.cos(4*Math.PI*r/(t-1))-.01168*Math.cos(6*Math.PI*r/(t-1)))}static blackmanNuttall(t){return Array.from({length:t},(e,r)=>.3635819-.4891775*Math.cos(2*Math.PI*r/(t-1))+.1365995*Math.cos(4*Math.PI*r/(t-1))-.0106411*Math.cos(6*Math.PI*r/(t-1)))}static kaiser(t,e=8.6){const r=n(e),s=t-1;return Array.from({length:t},(t,a)=>{const o=2*a/s-1;return n(e*Math.sqrt(1-o*o))/r})}static tukey(t,e=.5){const r=t-1;return Array.from({length:t},(t,s)=>{const a=s/r;return e<=0?1:e>=1?.5*(1-Math.cos(2*Math.PI*a)):a<e/2?.5*(1+Math.cos(Math.PI*(2*a/e-1))):a<=1-e/2?1:.5*(1+Math.cos(Math.PI*(2*a/e-2/e+1)))})}static gauss(t,e=.4){const r=(t-1)/2;return Array.from({length:t},(t,s)=>{const a=(s-r)/(e*r);return Math.exp(-.5*a*a)})}static bartlett(t){const e=t-1;return Array.from({length:t},(t,r)=>1-Math.abs((r-e/2)/(e/2)))}static bartlettHann(t){const e=t-1;return Array.from({length:t},(t,r)=>{const s=r/e;return.62-.48*Math.abs(s-.5)-.38*Math.cos(2*Math.PI*s)})}static cosine(t){const e=t-1;return Array.from({length:t},(t,r)=>Math.sin(Math.PI*r/e))}static lanczos(t){const e=(t-1)/2;return Array.from({length:t},(t,r)=>{return 0===(s=(r-e)/e)?1:Math.sin(Math.PI*s)/(Math.PI*s);var s})}static bohman(t){const e=(t-1)/2;return Array.from({length:t},(t,r)=>{const s=Math.abs(r-e)/e;return s<=1?(1-s)*Math.cos(Math.PI*s)+1/Math.PI*Math.sin(Math.PI*s):0})}static flatTop(t){const e=t-1;return Array.from({length:t},(t,r)=>1-1.93*Math.cos(2*Math.PI*r/e)+1.29*Math.cos(4*Math.PI*r/e)-.388*Math.cos(6*Math.PI*r/e)+.028*Math.cos(8*Math.PI*r/e))}static byName(t,e,r={}){const{beta:s=8.6,alpha:n=.5,sigma:o=.4}=r||{};switch(t){case"hann":return a.hann(e);case"hamming":return a.hamming(e);case"blackman":return a.blackman(e);case"blackmanHarris":return a.blackmanHarris(e);case"blackmanNuttall":return a.blackmanNuttall(e);case"rectangle":case"rect":default:return a.rect(e);case"bartlett":return a.bartlett(e);case"bartlettHann":return a.bartlettHann(e);case"cosine":return a.cosine(e);case"lanczos":return a.lanczos(e);case"bohman":return a.bohman(e);case"gauss":case"gaussian":return a.gauss(e,o);case"tukey":return a.tukey(e,n);case"kaiser":return a.kaiser(e,s);case"flatTop":case"flattop":return a.flatTop(e)}}}const n=t=>{const e=Math.abs(t);if(e<3.75){const e=t/3.75,r=e*e;return 1+r*(3.5156229+r*(3.0899424+r*(1.2067492+r*(.2659732+r*(.0360768+.0045813*r)))))}{const t=3.75/e;return Math.exp(e)/Math.sqrt(e)*(.39894228+t*(.01328592+t*(.00225319+t*(t*(.00916281+t*(t*(.02635537+t*(.00392377*t-.01647633))-.02057706))-.00157565))))}};class o{static sinc(t){return 0===t?1:Math.sin(Math.PI*t)/(Math.PI*t)}static idealLowpass(t,e,r){const s=r-1,a=t/e;return Array.from({length:r},(t,e)=>o.sinc(2*(e-s/2)*a))}}class i{static design(t,e,r,s,n="hann"){const c=s+1,l=a.byName(n,c),h=c-1,u=t=>t.map((t,e)=>t*l[e]);if("lowpass"===t){const t=e;let s=o.idealLowpass(t,r,c);const a=2*t/r;return s=s.map(t=>t*a),{b:u(s),a:[1]}}if("highpass"===t){const t=e;return{b:i.design("lowpass",t,r,s,n).b.map((t,e)=>e===h/2?1-t:-t),a:[1]}}if("bandpass"===t){const[t,a]=e,o=i.design("lowpass",a,r,s,n).b,c=i.design("lowpass",t,r,s,n).b;return{b:o.map((t,e)=>t-c[e]),a:[1]}}if("bandstop"===t){const[t,a]=e;return{b:i.design("bandpass",[t,a],r,s,n).b.map((t,e)=>e===h/2?1-t:-t),a:[1]}}throw new Error("Unsupported FIR type")}static apply(t,e){return r.convolve(e,t)}static overlapAdd(e,a,n){const o=n||1024,i=e.length,c=r.nextPow2(o+i-1),l=s.fft(Array.from({length:c},(r,s)=>t.of(e[s]||0,0))),h=new Array(a.length+i-1).fill(0);for(let e=0;e<a.length;e+=o){const r=Array.from({length:c},(r,s)=>t.of(a[e+s]||0,0)),n=s.fft(r).map((e,r)=>t.mul(e,l[r])),u=s.ifft(n);for(let t=0;t<o+i-1;t++)h[e+t]+=u[t].re}return h}}class c{static prewarp(t,e){return 2*e*Math.tan(Math.PI*t/e)}}class l{static butterworthPoles(e){const r=[];for(let s=0;s<e;s++){const a=Math.PI*(2*s+1+e)/(2*e),n=t.of(Math.cos(a),Math.sin(a));n.re<0&&r.push(n)}return r}static cheby1Poles(e,r=1){const s=Math.sqrt(Math.pow(10,r/10)-1),a=Math.asinh(1/s)/e,n=Math.sinh(a),o=Math.cosh(a),i=[];for(let r=0;r<e;r++){const s=Math.PI*(2*r+1)/(2*e),a=-n*Math.sin(s),c=o*Math.cos(s),l=t.of(a,c);l.re<0&&i.push(l)}return i}static cheby2PolesAndZeros(e,r){const s=Math.sqrt(Math.pow(10,r/10)-1),a=Math.asinh(s)/e,n=Math.sinh(a),o=Math.cosh(a),i=[];for(let r=1;r<=e;r++){const s=Math.PI*(2*r-1)/(2*e),a=-n*Math.sin(s),c=o*Math.cos(s);a<0&&i.push(t.of(a,c))}const c=[],l=Math.floor(e/2);for(let t=1;t<=l;t++){const r=Math.PI*(2*t-1)/(2*e);c.push(1/Math.cos(r))}return{poles:i,zerosW:c}}static pairConjugates(t){const e=new Array(t.length).fill(!1),r=[];for(let s=0;s<t.length;s++){if(e[s])continue;const a=t[s];let n=-1;for(let r=s+1;r<t.length;r++){if(e[r])continue;const s=t[r];if(Math.abs(a.re-s.re)<1e-12&&Math.abs(a.im+s.im)<1e-12){n=r;break}}n>=0?(r.push([a,t[n]]),e[s]=e[n]=!0):(r.push([a]),e[s]=!0)}return r}static bilinearMapBiquad(t,e,r,s,a,n,o){const i=2*o,c=s*i*i+a*i+n;return{b:[(t*i*i+e*i+r)/c,2*(r-t*i*i)/c,(t*i*i-e*i+r)/c],a:[1,2*(n-s*i*i)/c,(s*i*i-a*i+n)/c]}}static _evalHzAtZ(t,e,r){return t.reduce((t,e,s)=>t+e*Math.pow(r,-s),0)/e.reduce((t,e,s)=>t+e*Math.pow(r,-s),0)}static fromPrototype(t,e,s,a,n){const o=[],i=l.pairConjugates(s);for(const r of i){const[s,a]=2===r.length?r:[r[0],null];let i,c,h,u,f,m,p,b,g;if(a?(i=1,c=-2*s.re,h=s.re*s.re+s.im*s.im):(i=0,c=1,h=-s.re),"lowpass"===t)u=i,f=c*n,m=h*n*n,p=0,b=0,g=1;else{if("highpass"!==t)throw new Error("fromPrototype supports only lowpass/highpass");0!==i?(u=h,f=c*n,m=i*n*n,p=1,b=0,g=0):(u=0,f=h,m=c*n,p=0,b=1,g=0)}o.push(l.bilinearMapBiquad(p,b,g,u,f,m,e))}let c=[1],h=[1];for(const t of o)c=r.polymul(c,t.b),h=r.polymul(h,t.a);const u=1/l._evalHzAtZ(c,h,a);if(o.length>0){const t=o.length-1;o[t].b=o[t].b.map(t=>t*u)}c=[1],h=[1];for(const t of o)c=r.polymul(c,t.b),h=r.polymul(h,t.a);return{b:c,a:h,sections:o}}static butterworth(t,e,r,s){if(s<1)throw new Error("Order must be >= 1");if("lowpass"===t||"highpass"===t){const a=e,n=c.prewarp(a,r),o=l.butterworthPoles(s),i="lowpass"===t?1:-1,h=l.fromPrototype(t,r,o,i,n);return{b:h.b,a:h.a,sections:h.sections}}if("bandpass"===t||"bandstop"===t){const[a,n]=e;if(!(a>0&&n>a&&n<r/2))throw new Error("Invalid band edges");const o=Math.max(64,8*s),c=i.design(t,[a,n],r,o,"hamming");return{b:c.b,a:c.a,sections:[]}}throw new Error("Unsupported IIR kind")}static cheby1(t,e,r,s,a=1){if(s<1)throw new Error("Order must be >= 1");if("lowpass"===t||"highpass"===t){const n=e,o=c.prewarp(n,r),i=l.cheby1Poles(s,a),h="lowpass"===t?1:-1,u=l.fromPrototype(t,r,i,h,o);return{b:u.b,a:u.a,sections:u.sections}}if("bandpass"===t||"bandstop"===t){const[a,n]=e;if(!(a>0&&n>a&&n<r/2))throw new Error("Invalid band edges");const o=Math.max(64,8*s),c=i.design(t,[a,n],r,o,"hamming");return{b:c.b,a:c.a,sections:[]}}throw new Error("Unsupported IIR kind")}static cheby2(e,s,a,n,o=40){if(n<1)throw new Error("Order must be >= 1");if("lowpass"!==e){const t=Math.max(64,8*n),r=i.design(e,s,a,t,"hamming");return{b:r.b,a:r.a,sections:[]}}const h=s,u=c.prewarp(h,a),{poles:f,zerosW:m}=l.cheby2PolesAndZeros(n,o),p=f.map(e=>t.of(e.re*u,e.im*u)),b=m.map(t=>u*t),g=l.pairConjugates(p),M=[],w=[],y=[];let d=0;for(const t of g){const[e,r]=2===t.length?t:[t[0],null];if(r){const t=1,r=-2*e.re,s=e.re*e.re+e.im*e.im;let a,n,o;if(d<b.length){const t=b[d++];a=1,n=0,o=t*t}else a=0,n=0,o=1;M.push({b2:a,b1:n,b0:o,a2:t,a1:r,a0:s}),w.push(o),y.push(s)}else{const t=0,r=1,s=-e.re,a=0,n=0,o=1;M.push({b2:a,b1:n,b0:o,a2:t,a1:r,a0:s}),w.push(1),y.push(s)}}const I=t=>t.reduce((t,e)=>t*e,1),P=I(y)/I(w);if(M.length>0){const t=M.length-1;M[t].b2*=P,M[t].b1*=P,M[t].b0*=P}const A=M.map(t=>l.bilinearMapBiquad(t.b2,t.b1,t.b0,t.a2,t.a1,t.a0,a));let _=[1],k=[1];for(const t of A)_=r.polymul(_,t.b),k=r.polymul(k,t.a);const v=1/l._evalHzAtZ(_,k,1);if(A.length>0){const t=A.length-1;A[t].b=A[t].b.map(t=>t*v)}_=[1],k=[1];for(const t of A)_=r.polymul(_,t.b),k=r.polymul(k,t.a);return{b:_,a:k,sections:A}}static linkwitzRiley(t,e,s,a=4){if(a<2)throw new Error("Order must be >= 2");const n=(a%2==0?a:a+1)/2,o=l.butterworth(t,e,s,n),i=o.sections.concat(o.sections.map(t=>({b:t.b.slice(),a:t.a.slice()})));return{b:r.polymul(o.b,o.b),a:r.polymul(o.a,o.a),sections:i}}}class h{static evalHz(e,r,s){const a=t.div(t.of(1,0),s),n=e=>{let r=t.of(1,0);for(let s=0;s<e;s++)r=t.mul(r,a);return r};let o=t.of(0,0);for(let r=0;r<e.length;r++)o=t.add(o,t.scale(n(r),e[r]));let i=t.of(1,0);for(let e=1;e<r.length;e++)i=t.add(i,t.scale(n(e),r[e]));return t.div(o,i)}static freqz(e,s,a=512){const n=r.linspace(0,Math.PI,a),o=n.map(r=>h.evalHz(e,s,t.expj(r))),i=o.map(t.abs),c=o.map(t.arg);return{w:n,H:o,mag:i,phase:c}}static groupDelay(t,e,r=512){const{w:s,phase:a}=h.freqz(t,e,r),n=[...a];for(let t=1;t<n.length;t++){let e=n[t]-n[t-1];for(;e>Math.PI;)n[t]-=2*Math.PI,e-=2*Math.PI;for(;e<-Math.PI;)n[t]+=2*Math.PI,e+=2*Math.PI}const o=s[1]-s[0];return{w:s,gd:n.map((t,e)=>0===e||e===n.length-1?0:-(n[e+1]-n[e-1])/(2*o))}}static isStable(){return!0}}class u{constructor(t,e=[1],r=[]){if(Math.abs(e[0]-1)>1e-12&&(t=t.map(t=>t/e[0]),e=e.map(t=>t/e[0])),this.b=t.slice(),this.a=e.slice(),this.sections=(r||[]).map(t=>({b:t.b.slice(),a:[1,t.a[1],t.a[2]]})),this.sections.length>0)this._sosState=this.sections.map(()=>({w1:0,w2:0}));else if(1===this.a.length)this._firIdx=0,this._firBuf=new Array(this.b.length).fill(0);else{const t=Math.max(this.b.length,this.a.length)-1;this._iirW=new Array(t).fill(0)}}reset(){this._sosState&&this._sosState.forEach(t=>{t.w1=0,t.w2=0}),this._firBuf&&(this._firBuf.fill(0),this._firIdx=0),this._iirW&&this._iirW.fill(0)}processSample(t){if(this.sections.length>0){let e=t;for(let t=0;t<this.sections.length;t++){const{b:r,a:s}=this.sections[t],a=this._sosState[t],n=e-s[1]*a.w1-s[2]*a.w2,o=r[0]*n+r[1]*a.w1+r[2]*a.w2;a.w2=a.w1,a.w1=n,e=o}return e}if(1===this.a.length){this._firBuf[this._firIdx]=t;let e=0,r=this._firIdx;for(let t=0;t<this.b.length;t++)e+=this.b[t]*this._firBuf[r],r=(r-1+this._firBuf.length)%this._firBuf.length;return this._firIdx=(this._firIdx+1)%this._firBuf.length,e}let e=t;for(let t=1;t<this.a.length;t++)e-=this.a[t]*(this._iirW[t-1]||0);let r=this.b[0]*e;for(let t=1;t<this.b.length;t++)r+=(this._iirW[t-1]||0)*this.b[t];for(let t=this._iirW.length-1;t>0;t--)this._iirW[t]=this._iirW[t-1];return this._iirW[0]=e,r}applySignal(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=this.processSample(t[r]);return e}frequencyResponse(t,e=1024){const r=h.freqz(this.b,this.a,e);return{f:r.w.map(e=>e*t/(2*Math.PI)),mag:r.mag,phase:r.phase,H:r.H}}toJSON(){return{b:this.b.slice(),a:this.a.slice()}}static fromTF(t,e){return new u(t,e)}static designFIR(t,e,r,s,a="hann"){const n=i.design(t,e,r,s,a);return new u(n.b,n.a)}static designButter(t,e,r,s){const a=l.butterworth(t,e,r,s);return new u(a.b,a.a,a.sections)}static designCheby1(t,e,r,s,a=1){const n=l.cheby1(t,e,r,s,a);return new u(n.b,n.a,n.sections)}static designCheby2(t,e,r,s,a=40){const n=l.cheby2(t,e,r,s,a);return new u(n.b,n.a,n.sections)}static designLinkwitzRiley(t,e,r,s=4){const a=l.linkwitzRiley(t,e,r,s);return new u(a.b,a.a,a.sections)}}const f={design:(t,e,r,s,a="hann")=>i.design(t,e,r,s,a),apply:(t,e)=>i.apply(t,e),overlapAdd:(t,e,r)=>i.overlapAdd(t,e,r)},m={butterworth:(t,e,r,s)=>{const a=l.butterworth(t,e,r,s);return{b:a.b,a:a.a}},cheby1:(t,e,r,s,a=1)=>{const n=l.cheby1(t,e,r,s,a);return{b:n.b,a:n.a}},cheby2:(t,e,r,s,a=40)=>{const n=l.cheby2(t,e,r,s,a);return{b:n.b,a:n.a}},linkwitzRiley:(t,e,r,s=4)=>{const a=l.linkwitzRiley(t,e,r,s);return{b:a.b,a:a.a}},apply:(t,e,r)=>u.fromTF(t,e).applySignal(r)},p={evalHz:(t,e,r)=>h.evalHz(t,e,r),freqz:(t,e,r=512)=>h.freqz(t,e,r),groupDelay:(t,e,r=512)=>h.groupDelay(t,e,r),isStable:()=>h.isStable()};var b={ComplexNum:t,C:e,Util:r,FFT:s,Window:a,Kernels:o,FIRDesigner:i,IIRDesigner:l,Bilinear:c,ZDomain:h,Filter:u,FIR:f,IIR:m,Z:p};export{c as Bilinear,e as C,t as ComplexNum,s as FFT,f as FIR,i as FIRDesigner,u as Filter,m as IIR,l as IIRDesigner,o as Kernels,r as Util,a as Window,p as Z,h as ZDomain,b as default};
//# sourceMappingURL=dsp-filter-library.esm.min.js.map
