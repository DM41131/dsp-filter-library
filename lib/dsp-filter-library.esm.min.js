class e{static add(e,t){return{re:e.re+t.re,im:e.im+t.im}}static sub(e,t){return{re:e.re-t.re,im:e.im-t.im}}static mul(e,t){return{re:e.re*t.re-e.im*t.im,im:e.re*t.im+e.im*t.re}}static div(e,t){const r=t.re*t.re+t.im*t.im||1e-300;return{re:(e.re*t.re+e.im*t.im)/r,im:(e.im*t.re-e.re*t.im)/r}}static abs(e){return Math.hypot(e.re,e.im)}static conj(e){return{re:e.re,im:-e.im}}}const t=2*Math.PI;function r(e,t,r){const s=new Array(r),i=(t-e)/(r-1);for(let t=0;t<r;t++)s[t]=e+t*i;return s}function s(e){const r=[...e];for(let e=0;e<2;e++)for(let e=1;e<r.length;e++){const s=r[e]-r[e-1];s>Math.PI&&(r[e]-=t),s<-Math.PI&&(r[e]+=t)}return r}class i{static evalRealAsc(t,r){let s={re:t[0],im:0};for(let i=1;i<t.length;i++)s=e.add(e.mul(s,r),{re:t[i],im:0});return s}}function n(t,r){const s=t.length-1;let i={re:1,im:0},n={re:0,im:0};for(let a=1;a<=s;a++)n=e.add(e.mul(n,r),i),i=e.add(e.mul(i,r),{re:t[a],im:0});return{p:i,dp:n}}class a{static aberthMonic(t){let r=0;for(;r<t.length-1&&Math.abs(t[r])<1e-18;)r++;let s=t.slice(r);const i=s.length-1;if(i<=0)return[];const a=s[0];s=s.map(e=>e/a);let o=0;for(let e=1;e<s.length;e++)o=Math.max(o,Math.abs(s[e]));const c=Math.max(.5,Math.min(1.5,1+o)),h=new Array(i);for(let e=0;e<i;e++){const t=2*Math.PI*(e+.5)/i,r=1+.001*(e%2?1:-1);h[e]={re:c*r*Math.cos(t),im:c*r*Math.sin(t)}}const l=1e-14;for(let t=0;t<200;t++){let t=!1;for(let r=0;r<i;r++){const a=h[r],{p:o,dp:c}=n(s,a);let m={re:0,im:0};for(let t=0;t<i;t++)if(t!==r){let r=e.sub(a,h[t]);const s=r.re*r.re+r.im*r.im;s<1e-28&&(r={re:r.re+l,im:r.im});const i={re:r.re/(s||1e-300),im:-r.im/(s||1e-300)};m=e.add(m,i)}const u=e.sub(c,e.mul(o,m)),f=e.div(o,u),p=e.sub(a,f);Math.hypot(p.re-a.re,p.im-a.im)>1e-12&&(t=!0),h[r]=p}if(!t)break}return h}static dkScaled(t){let r=0;for(;r<t.length-1&&Math.abs(t[r])<1e-18;)r++;const s=t.slice(r),n=s.length-1;if(n<=0)return[];const a=s[0],o=s.map(e=>e/a),c=[];for(const t of[.8,1.1,1.5]){const r=new Array(n);for(let e=0;e<n;e++){const s=2*Math.PI*(e+1)/n;r[e]={re:t*Math.cos(s),im:t*Math.sin(s)}}for(let t=0;t<200;t++){let t=!1;for(let s=0;s<n;s++){let a={re:1,im:0};for(let t=0;t<n;t++)s!==t&&(a=e.mul(a,e.sub(r[s],r[t])));const c=i.evalRealAsc(o,r[s]),h=e.div(c,a),l=e.sub(r[s],h);Math.hypot(l.re-r[s].re,l.im-r[s].im)>1e-12&&(t=!0),r[s]=l}if(!t)break}c.push(...r)}return c}}class o{static butter(e){const t=[];for(let r=1;r<=e;r++){const s=(2*r-1)*Math.PI/(2*e);t.push({re:-Math.sin(s),im:Math.cos(s)})}return{poles:t,zeros:[]}}static cheby1(e,t){const r=Math.sqrt(Math.pow(10,t/10)-1),s=Math.asinh(1/r)/e,i=[];for(let t=1;t<=e;t++){const r=(2*t-1)*Math.PI/(2*e);i.push({re:-Math.sinh(s)*Math.sin(r),im:Math.cosh(s)*Math.cos(r)})}return{poles:i,zeros:[]}}static cheby2(e,t){const r=1/Math.sqrt(Math.pow(10,t/10)-1),s=Math.asinh(1/r)/e,i=[],n=[];for(let t=1;t<=e;t++){const r=(2*t-1)*Math.PI/(2*e);i.push({re:-Math.sinh(s)*Math.sin(r),im:Math.cosh(s)*Math.cos(r)})}const a=Math.floor(e/2);for(let t=1;t<=a;t++){const r=(2*t-1)*Math.PI/(2*e),s=1/Math.cos(r);n.push({re:0,im:s},{re:0,im:-s})}return{poles:i,zeros:n}}static ellipHybrid(e,t,r){const s=o.cheby1(e,t),i=o.cheby2(e,r);return{poles:s.poles,zeros:i.zeros}}static linkwitzRiley(e){const t=e%2==0?e:e+1,r=o.butter(t/2),s=[];return r.poles.forEach(e=>{s.push(e,{re:e.re,im:e.im})}),{poles:s,zeros:[],enforcedOrder:t}}static bessel(e){const t=Math.min(e,12),r=new Array(t+1).fill(0);r[0]=1;for(let e=1;e<=t;e++)r[e]=r[e-1]*((t+e)*(t-e+1))/(2*e);return{poles:(()=>{const e=r.length-1,t=new Array(e);for(let r=0;r<e;r++){const s=2*Math.PI*(r+1)/e;t[r]={re:1.5*Math.cos(s),im:1.5*Math.sin(s)}}for(let s=0;s<200;s++){let s=!1;for(let n=0;n<e;n++){let a={re:1,im:0};for(let r=0;r<e;r++)n!==r&&(a={re:a.re*(t[n].re-t[r].re)-a.im*(t[n].im-t[r].im),im:a.re*(t[n].im-t[r].im)+a.im*(t[n].re-t[r].re)});const o=i.evalRealAsc(r,t[n]),c={re:o.re/(a.re||1e-300),im:o.im/(a.re||1e-300)},h={re:t[n].re-c.re,im:t[n].im-c.im};Math.hypot(h.re-t[n].re,h.im-t[n].im)>1e-12&&(s=!0),t[n]=h}if(!s)break}return t.filter(e=>e.re<0||Math.abs(e.re)<1e-12)})(),zeros:[]}}}class c{static prewarp(e,t){return 2*t*Math.tan(Math.PI*e/t)}static sToZ(t,r){const s={re:2*r+t.re,im:t.im},i={re:2*r-t.re,im:-t.im};return e.div(s,i)}static quad(t,r,s){const i=e.mul(r,r),n=e.mul({re:4,im:0},e.mul(t,s)),a=function(e){const t=e.re,r=e.im,s=Math.hypot(t,r),i=Math.sqrt((s+Math.abs(t))/2);if(t>=0)return{re:i,im:r/(2*(i||1e-300))};const n=(r>=0?1:-1)*i;return{re:r/(2*(n||1e-300)),im:n}}({re:i.re-n.re,im:i.im-n.im}),o={re:-r.re,im:-r.im},c=e.mul({re:2,im:0},t);return[e.div(e.add(o,a),c),e.div(e.sub(o,a),c)]}}function h(e){const t=new Array(e.length).fill(!1),r=[];for(let s=0;s<e.length;s++){if(t[s])continue;const i=e[s];let n=!1;for(let a=s+1;a<e.length;a++)if(!t[a]){const o=e[a];if(Math.abs(i.re-o.re)<1e-10&&Math.abs(i.im+o.im)<1e-10){r.push([i,o]),t[s]=t[a]=!0,n=!0;break}}n||(r.push([i]),t[s]=!0)}return r}class l{static fromZPK(t,r,s=1){for(;t.length<r.length;)t.push({re:-1,im:0});const i=h(t),n=h(r),a=[];let o=0,c=0;for(;c<n.length;){const t=n[c++],r=o<i.length?i[o++]:[{re:-1,im:0},{re:-1,im:0}],s=t[0],h=t[1]||{re:0,im:0},l=r[0],m=r[1]||{re:-1,im:0},u={re:l.re+m.re,im:l.im+m.im},f=e.mul(l,m),p={re:s.re+h.re,im:s.im+h.im},M=e.mul(s,h),b=[1,-u.re,f.re],g=[1,-p.re,M.re];a.push({b:b,a:g})}return a.length&&(a[0].b=[a[0].b[0]*s,a[0].b[1]*s,a[0].b[2]*s]),a}}class m{static H_w_IIR(t,r){const s=Math.cos(r),i=-Math.sin(r),n=Math.cos(2*r),a=-Math.sin(2*r);let o={re:1,im:0};for(const r of t){const[t,c,h]=r.b,[,l,m]=r.a,u={re:t+c*s+h*n,im:c*i+h*a},f={re:1+l*s+m*n,im:l*i+m*a},p=f.re*f.re+f.im*f.im,M={re:(u.re*f.re+u.im*f.im)/p,im:(u.im*f.re-u.re*f.im)/p};o=e.mul(o,M)}return o}static H_w_FIR(e,t){let r=0,s=0;for(let i=0;i<e.length;i++)r+=e[i]*Math.cos(t*i),s-=e[i]*Math.sin(t*i);return{re:r,im:s}}static magDbFromH(t){return 20*Math.log10(Math.max(1e-16,e.abs(t)))}static unwrapToDeg(e){return s(e).map(e=>180*e/Math.PI)}static groupDelay(e,t){const r=t.length,s=new Array(r).fill(0);if(r>=3){for(let i=1;i<r-1;i++){const r=e[i+1]-e[i-1],n=t[i+1]-t[i-1];s[i]=-r/(n||1e-12)}s[0]=s[1],s[r-1]=s[r-2]}return s}static phaseDelay(e,t){const r=new Array(t.length).fill(0);for(let s=0;s<t.length;s++)r[s]=0===t[s]?NaN:-e[s]/t[s];let s=r.find(e=>Number.isFinite(e));Number.isFinite(s)||(s=0);for(let e=0;e<r.length&&!Number.isFinite(r[e]);e++)r[e]=s;for(let e=1;e<r.length;e++)Number.isFinite(r[e])||(r[e]=r[e-1]);return r}}class u{static rect(e){return Array.from({length:e},()=>1)}static hann(e){return Array.from({length:e},(t,r)=>.5*(1-Math.cos(2*Math.PI*r/(e-1))))}static hamming(e){return Array.from({length:e},(t,r)=>.54-.46*Math.cos(2*Math.PI*r/(e-1)))}static blackman(e){return Array.from({length:e},(t,r)=>.42-.5*Math.cos(2*Math.PI*r/(e-1))+.08*Math.cos(4*Math.PI*r/(e-1)))}static kaiser(e,t){const r=e=>{let t=1,r=1,s=1;const i=e/2*(e/2);for(;s<32&&(r*=i/(s*s),t+=r,!(r<1e-12));s++);return t},s=r(t),i=new Array(e);for(let n=0;n<e;n++){const a=2*n/(e-1)-1;i[n]=r(t*Math.sqrt(1-a*a))/s}return i}static byName(e,t,r=6){switch(e){case"rect":return u.rect(t);case"hann":return u.hann(t);case"hamming":default:return u.hamming(t);case"blackman":return u.blackman(t);case"kaiser":return u.kaiser(t,r)}}}function f(e,t,r=1e-9){for(const s of e)if(Math.hypot(s.re-t.re,s.im-t.im)<r)return!1;return e.push(t),!0}class p{static fromTapsRobust(e){const t=e.length-1,r=new Array(e.length);for(let s=0;s<e.length;s++)r[s]=e[t-s];let s=0;for(;s<r.length-1&&Math.abs(r[s])<1e-18;)s++;const i=r.slice(s).length-1;if(i<=0)return[];const n=[];try{for(const e of a.aberthMonic(r))Number.isFinite(e.re)&&Number.isFinite(e.im)&&f(n,e)}catch{}try{for(const e of a.dkScaled(r))Number.isFinite(e.re)&&Number.isFinite(e.im)&&f(n,e)}catch{}if(n.length<i){const t=function(e,t){const r=8192,s=[],i=new Float64Array(r+1);for(let t=0;t<=r;t++){const s=Math.PI*t/r,n=m.H_w_FIR(e,s);i[t]=Math.hypot(n.re,n.im)}for(let e=1;e<r;e++)if(i[e]<i[e-1]&&i[e]<i[e+1]){const i=Math.PI*e/r;if(s.push({re:Math.cos(i),im:Math.sin(i)}),s.length>=t)break}return s}(e,i-n.length);for(const e of t)f(n,e,1e-6)}const o=function(e,t=1e-9){const r=[];for(const s of e)f(r,s,t),Math.abs(s.im)>1e-12&&f(r,{re:s.re,im:-s.im},t);return r}(n),c=[];for(const e of o)if(f(c,e,1e-9)&&c.length===i)break;return c.length>i?c.slice(0,i):c}}class M{constructor(e){this.init=e,this._zeros=null}get type(){return"FIR"}get taps(){return this.init.taps}get Fs(){return this.init.Fs}impulseResponse(e=256){return this.taps.slice(0,e)}zeros(){return this._zeros||(this._zeros=p.fromTapsRobust(this.taps)),this._zeros}frequencyGrid(e=1024){const t=r(0,Math.PI,e),i=[],n=[];for(const e of t){const t=m.H_w_FIR(this.taps,e);i.push(m.magDbFromH(t)),n.push(Math.atan2(t.im,t.re))}const a=s(n),o=m.groupDelay(a,t),c=m.phaseDelay(a,t),h=t.map(e=>e/Math.PI*(this.Fs/2));return{w:t,freqHz:h,magdB:i,phaseDeg:a.map(e=>180*e/Math.PI),gdSamples:o,pdSamples:c}}}function b(e){return 0===e?1:Math.sin(Math.PI*e)/(Math.PI*e)}class g{constructor(e){this.spec=e}design(){const{kind:e,taps:t,Fs:r,f1:s,f2:i=s,window:n="hamming",beta:a=6}=this.spec,o=(t-1)/2,c=2*Math.PI*(s/r),h=2*Math.PI*(i/r),l=u.byName(n,t,a),f=new Array(t).fill(0),p=e=>{const r=new Array(t);for(let s=0;s<t;s++)r[s]=2*e/(2*Math.PI)*b((s-o)*e/Math.PI);return r};if("lowpass"===e){const e=p(c);for(let r=0;r<t;r++)f[r]=e[r]*l[r]}else if("highpass"===e){const e=p(c);for(let r=0;r<t;r++){const t=r===o?1:0;f[r]=(t-e[r])*l[r]}}else if("bandpass"===e){const e=p(h),r=p(c);for(let s=0;s<t;s++)f[s]=(e[s]-r[s])*l[s]}else{const e=p(h),r=p(c);for(let s=0;s<t;s++){const t=s===o?1:0;f[s]=(t-(e[s]-r[s]))*l[s]}}let g=0;if("highpass"===e&&(g=Math.PI),"bandpass"===e){const e=Math.sqrt(s*i);g=2*Math.PI*(e/r)}const d=m.H_w_FIR(f,g),y=1/(Math.hypot(d.re,d.im)||1e-12);for(let e=0;e<t;e++)f[e]*=y;return new M({taps:f,Fs:r})}}class d{constructor(e){this.init=e}get type(){return"IIR"}get sections(){return this.init.sections}get Fs(){return this.init.Fs}get zPoles(){return this.init.zPoles}get zZeros(){return this.init.zZeros}impulseResponse(e=256){const t=new Array(e).fill(0);t[0]=1;let r=t.slice();for(const t of this.sections){const[s,i,n]=t.b,[,a,o]=t.a,c=new Array(e).fill(0);let h=0,l=0;for(let t=0;t<e;t++){const e=r[t]-a*h-o*l,m=s*e+i*h+n*l;c[t]=m,l=h,h=e}r=c}return r}frequencyGrid(e=1024){const t=r(0,Math.PI,e),i=[],n=[];for(const e of t){const t=m.H_w_IIR(this.sections,e);i.push(m.magDbFromH(t)),n.push(Math.atan2(t.im,t.re))}const a=s(n),o=m.groupDelay(a,t),c=m.phaseDelay(a,t),h=t.map(e=>e/Math.PI*(this.Fs/2));return{w:t,freqHz:h,magdB:i,phaseDeg:a.map(e=>180*e/Math.PI),gdSamples:o,pdSamples:c}}}function y(e,t){const r=t.re*t.re+t.im*t.im||1e-300;return{re:(e.re*t.re+0*t.im)/r,im:(0*t.re-e.re*t.im)/r}}class w{constructor(e){this.spec=e}design(){const{family:e,kind:t,Fs:r}=this.spec;let{N:s,f1:i,f2:n}=this.spec;const a=this.spec.Rp??1,h=this.spec.Rs??60;let u;switch(e){case"butter":default:u=o.butter(s);break;case"cheby1":u=o.cheby1(s,a);break;case"cheby2":u=o.cheby2(s,h);break;case"ellip":u=o.ellipHybrid(s,a,h);break;case"linkwitz":{const e=o.linkwitzRiley(s);s=e.enforcedOrder??s,u={poles:e.poles,zeros:[]};break}case"bessel":u=o.bessel(s)}u.family=e,u.order=s;let f=[],p=[];if("lowpass"===t||"highpass"===t){const n=c.prewarp(i,r),a=u.poles.map(e=>"lowpass"===t?{re:e.re*n,im:e.im*n}:y({re:n},e)),o=u.zeros.map(e=>"lowpass"===t?{re:e.re*n,im:e.im*n}:y({re:n},e));if(f=a.map(e=>c.sToZ(e,r)),p=o.map(e=>c.sToZ(e,r)),["butter","cheby1","bessel","linkwitz"].includes(e)&&"highpass"===t)for(let e=0;e<s;e++)p.push({re:1,im:0})}else{if(!n)throw new Error("bandpass/bandstop require f2");if(n<i){const e=i;i=n,n=e}const a=c.prewarp(i,r),o=c.prewarp(n,r),h=o-a,l=Math.sqrt(a*o),m=[],M=[];if("bandpass"===t){for(const e of u.poles){const[t,r]=c.quad({re:1,im:0},{re:-e.re*h,im:-e.im*h},{re:l*l,im:0});m.push(t,r)}for(const e of u.zeros){const[t,r]=c.quad({re:1,im:0},{re:-e.re*h,im:-e.im*h},{re:l*l,im:0});M.push(t,r)}if(["butter","cheby1","bessel","linkwitz"].includes(e))for(let e=0;e<s;e++)M.push({re:0,im:0});if(f=m.map(e=>c.sToZ(e,r)),p=M.map(e=>c.sToZ(e,r)),["butter","cheby1","bessel","linkwitz"].includes(e))for(let e=0;e<s;e++)p.push({re:-1,im:0});else"cheby2"===e&&s%2==1&&p.push({re:1,im:0},{re:-1,im:0})}else{for(const e of u.poles){const[t,r]=c.quad({re:e.re,im:e.im},{re:-h,im:0},{re:e.re*l*l,im:e.im*l*l});m.push(t,r)}for(const e of u.zeros){const[t,r]=c.quad({re:e.re,im:e.im},{re:-h,im:0},{re:e.re*l*l,im:e.im*l*l});M.push(t,r)}for(let e=0;e<s;e++)M.push({re:0,im:l},{re:0,im:-l});f=m.map(e=>c.sToZ(e,r)),p=M.map(e=>c.sToZ(e,r))}}const M=l.fromZPK(p,f,1);let b=0;if("highpass"===t&&(b=Math.PI),"bandpass"===t){const e=Math.sqrt(i*n);b=2*Math.PI*(e/r)}const g=m.H_w_IIR(M,b),w=1/(Math.hypot(g.re,g.im)||1e-12);return M[0].b=[M[0].b[0]*w,M[0].b[1]*w,M[0].b[2]*w],new d({sections:M,Fs:r,zPoles:f,zZeros:p})}}class I{static designFIR(e){return new g(e).design()}static designIIR(e){return new w(e).design()}}export{c as BLT,e as Cx,g as FIRDesigner,M as FIRFilter,p as FIRZeros,I as FilterDSP,w as IIRDesigner,d as IIRFilter,i as Poly,o as Prototypes,m as Response,a as Roots,l as SOS,t as TAU,u as Windows,r as linspace,s as unwrapPhase};
//# sourceMappingURL=dsp-filter-library.esm.min.js.map
