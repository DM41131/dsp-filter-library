{"version":3,"file":"utils.js","sources":["../src/utils.js"],"sourcesContent":["// utils.js â€” Mathematical utilities for DSP\r\n// License: MIT\r\n\r\nimport { ComplexNum as C } from './complex.js';\r\n\r\n/**\r\n * Utility functions for digital signal processing\r\n */\r\nexport class Util {\r\n    static nextPow2(n) { \r\n        let p = 1; \r\n        while (p < n) p <<= 1; \r\n        return p; \r\n    }\r\n    \r\n    static clamp(v, lo, hi) { \r\n        return Math.min(hi, Math.max(lo, v)); \r\n    }\r\n    \r\n    static linspace(start, end, n) {\r\n        if (n <= 1) return [start];\r\n        const step = (end - start) / (n - 1);\r\n        return Array.from({ length: n }, (_, i) => start + i * step);\r\n    }\r\n    \r\n    /** Horner's method for real or complex polynomial evaluation */\r\n    static polyval(c, z) {\r\n        if (typeof z === 'number') {\r\n            let y = 0;\r\n            for (let i = 0; i < c.length; i++) y = y * z + c[i];\r\n            return y;\r\n        } else {\r\n            let y = C.of(0, 0);\r\n            for (let i = 0; i < c.length; i++) y = C.add(C.mul(y, z), C.of(c[i], 0));\r\n            return y;\r\n        }\r\n    }\r\n    \r\n    static convolve(x, h) {\r\n        const y = new Array(x.length + h.length - 1).fill(0);\r\n        for (let i = 0; i < x.length; i++) {\r\n            const xi = x[i];\r\n            for (let j = 0; j < h.length; j++) y[i + j] += xi * h[j];\r\n        }\r\n        return y;\r\n    }\r\n    \r\n    static polymul(a, b) {\r\n        const na = a.length, nb = b.length;\r\n        const r = new Array(na + nb - 1).fill(0);\r\n        for (let i = 0; i < na; i++)\r\n            for (let j = 0; j < nb; j++)\r\n                r[i + j] += a[i] * b[j];\r\n        return r;\r\n    }\r\n    \r\n    /** Real-coefficient polynomial from complex roots (pairs conjugates) */\r\n    static polyfromroots(roots) {\r\n        const used = new Array(roots.length).fill(false);\r\n        let p = [1];\r\n        for (let i = 0; i < roots.length; i++) {\r\n            if (used[i]) continue;\r\n            const r = roots[i];\r\n            let paired = -1;\r\n            for (let j = i + 1; j < roots.length; j++) {\r\n                if (used[j]) continue;\r\n                const s = roots[j];\r\n                if (Math.abs(r.re - s.re) < 1e-12 && Math.abs(r.im + s.im) < 1e-12) { \r\n                    paired = j; \r\n                    break; \r\n                }\r\n            }\r\n            if (Math.abs(r.im) < 1e-14 || paired < 0) {\r\n                p = Util.polymul(p, [1, -r.re]);\r\n                used[i] = true;\r\n            } else {\r\n                const a2 = [1, -2*r.re, r.re*r.re + r.im*r.im];\r\n                p = Util.polymul(p, a2);\r\n                used[i] = used[paired] = true;\r\n            }\r\n        }\r\n        return p;\r\n    }\r\n}\r\n"],"names":["C"],"mappings":"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"}