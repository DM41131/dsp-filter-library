{"version":3,"file":"FIRDesigner.js","sources":["../../src/fir/FIRDesigner.js"],"sourcesContent":["// FIR filter designer\r\nimport { Response } from \"../digital/Response.js\";\r\nimport { Windows } from \"./Windows.js\";\r\nimport { FIRFilter } from \"../model/FIRFilter.js\";\r\n\r\nfunction sincNorm(x){ return x===0 ? 1 : Math.sin(Math.PI*x)/(Math.PI*x); }\r\n\r\nexport class FIRDesigner {\r\n  constructor(spec){\r\n    this.spec = spec; // {kind,taps,Fs,f1,f2?,window?,beta?}\r\n  }\r\n  design(){\r\n    const { kind, taps: M, Fs, f1, f2=f1, window='hamming', beta=6 } = this.spec;\r\n    const mid=(M-1)/2, w1=2*Math.PI*(f1/Fs), w2=2*Math.PI*(f2/Fs);\r\n    const win=Windows.byName(window, M, beta), h=new Array(M).fill(0);\r\n\r\n    const lpAt=(omega_c)=>{\r\n      const hlp=new Array(M);\r\n      for(let n=0;n<M;n++) hlp[n]= 2*omega_c/(2*Math.PI) * sincNorm((n-mid)*omega_c/Math.PI);\r\n      return hlp;\r\n    };\r\n\r\n    if(kind==='lowpass'){\r\n      const hlp=lpAt(w1); for(let n=0;n<M;n++) h[n]=hlp[n]*win[n];\r\n    } else if(kind==='highpass'){\r\n      const hlp=lpAt(w1); for(let n=0;n<M;n++){ const d=(n===mid)?1:0; h[n]=(d-hlp[n])*win[n]; }\r\n    } else if(kind==='bandpass'){\r\n      const h2=lpAt(w2), h1=lpAt(w1); for(let n=0;n<M;n++) h[n]=(h2[n]-h1[n])*win[n];\r\n    } else {\r\n      const h2=lpAt(w2), h1=lpAt(w1);\r\n      for(let n=0;n<M;n++){ const d=(n===mid)?1:0; h[n]=(d-(h2[n]-h1[n]))*win[n]; }\r\n    }\r\n\r\n    let wRef=0;\r\n    if(kind==='highpass') wRef=Math.PI;\r\n    if(kind==='bandpass'){ const f0=Math.sqrt(f1*f2); wRef=2*Math.PI*(f0/Fs); }\r\n    const Href=Response.H_w_FIR(h,wRef), g=1/(Math.hypot(Href.re,Href.im)||1e-12);\r\n    for(let n=0;n<M;n++) h[n]*=g;\r\n\r\n    return new FIRFilter({taps:h, Fs});\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}