{"version":3,"file":"Prototypes.cjs","sources":["../../src/analog/Prototypes.js"],"sourcesContent":["// Analog filter prototypes\r\nimport { Poly } from \"../core/Polynomial.js\";\r\n\r\nexport class Prototypes {\r\n  static butter(N){\r\n    const poles=[], zeros=[];\r\n    for(let k=1;k<=N;k++){ const th=(2*k-1)*Math.PI/(2*N); poles.push({re:-Math.sin(th), im:Math.cos(th)}); }\r\n    return {poles, zeros};\r\n  }\r\n  static cheby1(N, Rp){\r\n    const eps=Math.sqrt(Math.pow(10, Rp/10)-1), alpha=Math.asinh(1/eps)/N;\r\n    const poles=[], zeros=[];\r\n    for(let k=1;k<=N;k++){ const th=(2*k-1)*Math.PI/(2*N); poles.push({re:-Math.sinh(alpha)*Math.sin(th), im:Math.cosh(alpha)*Math.cos(th)}); }\r\n    return {poles, zeros};\r\n  }\r\n  static cheby2(N, Rs){\r\n    const eps2=1/Math.sqrt(Math.pow(10, Rs/10)-1), alpha=Math.asinh(1/eps2)/N;\r\n    const poles=[], zeros=[];\r\n    for(let k=1;k<=N;k++){ const th=(2*k-1)*Math.PI/(2*N); poles.push({re:-Math.sinh(alpha)*Math.sin(th), im:Math.cosh(alpha)*Math.cos(th)}); }\r\n    const M=Math.floor(N/2);\r\n    for(let k=1;k<=M;k++){ const th=(2*k-1)*Math.PI/(2*N), Oz=1/Math.cos(th); zeros.push({re:0,im: Oz}, {re:0,im:-Oz}); }\r\n    return {poles, zeros};\r\n  }\r\n  // Educational hybrid (not exact elliptic)\r\n  static ellipHybrid(N, Rp, Rs){\r\n    const p=Prototypes.cheby1(N,Rp), z=Prototypes.cheby2(N,Rs);\r\n    return {poles:p.poles, zeros:z.zeros};\r\n  }\r\n  static linkwitzRiley(N){\r\n    const evenN=(N%2===0)?N:N+1;\r\n    const base=Prototypes.butter(evenN/2);\r\n    const poles=[]; base.poles.forEach(pl=>{ poles.push(pl,{re:pl.re,im:pl.im}); });\r\n    return {poles, zeros:[], enforcedOrder:evenN};\r\n  }\r\n  static bessel(N){\r\n    const n=Math.min(N,12); const a=new Array(n+1).fill(0); a[0]=1;\r\n    for(let k=1;k<=n;k++) a[k]=a[k-1]*((n+k)*(n-k+1))/(2*k);\r\n    // tiny DK for Bessel poly (ascending coeff eval)\r\n    const poles = (() => {\r\n      const nn=a.length-1, R=1.5, z=new Array(nn);\r\n      for(let i=0;i<nn;i++){ const ang=2*Math.PI*(i+1)/nn; z[i]={re:R*Math.cos(ang), im:R*Math.sin(ang)}; }\r\n      for(let it=0; it<200; it++){\r\n        let moved=false;\r\n        for(let i=0;i<nn;i++){\r\n          let denom={re:1,im:0};\r\n          for(let j=0;j<nn;j++) if(i!==j) denom={re:denom.re*(z[i].re-z[j].re)-denom.im*(z[i].im-z[j].im), im:denom.re*(z[i].im-z[j].im)+denom.im*(z[i].re-z[j].re)};\r\n          const f=Poly.evalRealAsc(a, z[i]);\r\n          const delta={re:f.re/(denom.re||1e-300), im:f.im/(denom.re||1e-300)}; // crude but ok\r\n          const ni={re:z[i].re-delta.re, im:z[i].im-delta.im};\r\n          if(Math.hypot(ni.re-z[i].re, ni.im-z[i].im)>1e-12) moved=true;\r\n          z[i]=ni;\r\n        }\r\n        if(!moved) break;\r\n      }\r\n      return z.filter(r=> r.re<0 || Math.abs(r.re)<1e-12);\r\n    })();\r\n    return {poles, zeros:[]};\r\n  }\r\n}\r\n"],"names":["Poly"],"mappings":"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"}